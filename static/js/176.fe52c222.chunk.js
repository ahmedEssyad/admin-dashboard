"use strict";(self.webpackChunkadmin_dashboard=self.webpackChunkadmin_dashboard||[]).push([[176],{11176:(e,r,t)=>{t.r(r),t.d(r,{default:()=>wt});var s=t(9950),i=t(28429),n=t(59254),a=t(14857),o=t(88060),l=t(16491),d=t(4447),c=t(46589),u=t(74489),x=t(83239),h=t(25333),m=t(82053),p=t(55660),j=t(41413),A=t(17239),g=t(74745),v=t(23266),y=t(14195),f=t(83563),b=t(73212),C=t(50294),w=t(59086),S=t(83337),P=t(10226),_=t(46639),D=t(249),R=t(32610),I=t(89299),k=t(95699),E=t(99905),q=t(11227),W=t(66387),N=t(95720),M=t(20760),$=t(43974),F=t(28973),B=t(71496),z=t(85923),T=t(44414);const L=()=>{const[e,r]=(0,s.useState)(null),[t,n]=(0,s.useState)([]),[a,o]=(0,s.useState)(0),[c,u]=(0,s.useState)(!1),x=(0,i.Zp)(),j=Boolean(e);(0,s.useEffect)((()=>{v();const e=setInterval(v,3e4);return()=>clearInterval(e)}),[]);const v=async()=>{try{u(!0);const e=await B.A.get("/notifications",{params:{limit:10}});n(e.data.data),o(e.data.unreadCount)}catch(e){console.error("Erreur lors du chargement des notifications:",e)}finally{u(!1)}},b=()=>{r(null)},C=e=>{switch(e){case"info":default:return(0,T.jsx)(I.A,{color:"info"});case"warning":return(0,T.jsx)(k.A,{color:"warning"});case"error":return(0,T.jsx)(E.A,{color:"error"});case"success":return(0,T.jsx)(q.A,{color:"success"})}};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(p.A,{title:"Notifications",children:(0,T.jsx)(h.A,{color:"inherit",onClick:e=>{r(e.currentTarget)},"aria-label":"notifications",children:(0,T.jsx)(d.A,{badgeContent:a,color:"error",children:(0,T.jsx)(W.A,{})})})}),(0,T.jsxs)(A.A,{anchorEl:e,open:j,onClose:b,PaperProps:{sx:{width:360,maxHeight:500,overflow:"auto"}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[(0,T.jsxs)(l.A,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,T.jsx)(m.A,{variant:"h6",children:"Notifications"}),a>0&&(0,T.jsx)(P.A,{startIcon:(0,T.jsx)(N.A,{}),size:"small",onClick:async()=>{try{await B.A.patch("/notifications/read-all"),n(t.map((e=>({...e,read:!0})))),o(0),z.oR.success("Toutes les notifications ont \xe9t\xe9 marqu\xe9es comme lues")}catch(e){console.error("Erreur lors de la mise \xe0 jour des notifications:",e),z.oR.error("Erreur lors de la mise \xe0 jour des notifications")}},children:"Tout marquer comme lu"})]}),(0,T.jsx)(g.A,{}),c?(0,T.jsx)(l.A,{sx:{p:3,textAlign:"center"},children:(0,T.jsx)(_.A,{size:24})}):0===t.length?(0,T.jsx)(l.A,{sx:{p:3,textAlign:"center"},children:(0,T.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"Aucune notification"})}):(0,T.jsx)(D.A,{sx:{p:0},children:t.map((e=>(0,T.jsxs)(R.Ay,{button:!0,onClick:()=>(async e=>{try{e.read||(await B.A.patch(`/notifications/${e._id}/read`),n(t.map((r=>r._id===e._id?{...r,read:!0}:r))),o((e=>Math.max(0,e-1)))),e.link&&x(e.link),b()}catch(r){console.error("Erreur lors du traitement de la notification:",r),z.oR.error("Erreur lors du traitement de la notification")}})(e),sx:{backgroundColor:e.read?"transparent":"rgba(0, 0, 0, 0.04)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.08)"}},children:[(0,T.jsx)(y.A,{children:C(e.type)}),(0,T.jsx)(f.A,{primary:e.message,secondary:(0,$.A)(new Date(e.createdAt),"PPP \xe0 p",{locale:F.A}),primaryTypographyProps:{variant:"body2",fontWeight:e.read?"normal":"bold"},secondaryTypographyProps:{variant:"caption"}}),(0,T.jsx)(h.A,{size:"small",edge:"end",onClick:r=>(async(e,r)=>{e.stopPropagation();try{await B.A.delete(`/notifications/${r}`);const e=t.filter((e=>e._id!==r));n(e),z.oR.success("Notification supprim\xe9e")}catch(s){console.error("Erreur lors de la suppression de la notification:",s),z.oR.error("Erreur lors de la suppression de la notification")}})(r,e._id),children:(0,T.jsx)(M.A,{fontSize:"small"})})]},e._id)))}),(0,T.jsx)(g.A,{}),(0,T.jsx)(l.A,{sx:{p:1},children:(0,T.jsx)(P.A,{fullWidth:!0,size:"small",onClick:()=>{b(),x("/admin/settings")},children:"Voir toutes les notifications"})})]})]})};var V=t(43161),U=t(57357),O=t(33738),K=t(39694),G=t(76787),H=t(7523),Q=t(16345),Z=t(71471),Y=t(29885),J=t(72541),X=t(7084),ee=t(64085),re=t(47520),te=t(49238),se=t(95050),ie=t(35834),ne=t(42074);const ae=e=>{let{mobileOpen:r,handleDrawerToggle:t,drawerWidth:n}=e;const o=(0,a.A)(),{currentUser:c,hasPermission:u}=(0,V.A)(),x=(0,i.zy)(),[h,A]=s.useState(null),v=e=>x.pathname===e;s.useEffect((()=>{const e=b.find((e=>e.subItems&&e.subItems.some((e=>v(e.path)))));e&&A(e.id)}),[x.pathname]);const b=[{id:"dashboard",text:"Tableau de bord",icon:(0,T.jsx)(G.A,{}),path:"/admin/dashboard",show:!0,badge:null},{id:"catalog",text:"Catalogue",icon:(0,T.jsx)(H.A,{}),show:u("products","read")&&"orderManager"!==(null===c||void 0===c?void 0:c.role)||u("categories","read")&&"contentEditor"===(null===c||void 0===c?void 0:c.role),subItems:[{id:"products",text:"Produits",icon:(0,T.jsx)(Q.A,{}),path:"/admin/products",show:u("products","read")&&"orderManager"!==(null===c||void 0===c?void 0:c.role),badge:null},{id:"categories",text:"Cat\xe9gories",icon:(0,T.jsx)(Z.A,{}),path:"/admin/categories",show:u("categories","read")&&("contentEditor"===(null===c||void 0===c?void 0:c.role)||"superAdmin"===(null===c||void 0===c?void 0:c.role)),badge:null},{id:"subcategories",text:"Sous-cat\xe9gories",icon:(0,T.jsx)(Y.A,{}),path:"/admin/subcategories",show:u("categories","read")&&("contentEditor"===(null===c||void 0===c?void 0:c.role)||"superAdmin"===(null===c||void 0===c?void 0:c.role)),badge:null}]},{id:"companies",text:"Entreprises",icon:(0,T.jsx)(J.A,{}),path:"/admin/companies",show:u("companies","read")&&("contentEditor"===(null===c||void 0===c?void 0:c.role)||"superAdmin"===(null===c||void 0===c?void 0:c.role)),badge:null},{id:"promotions",text:"Promotions",icon:(0,T.jsx)(X.A,{}),path:"/admin/promotions",show:u("products","update")&&"orderManager"!==(null===c||void 0===c?void 0:c.role),badge:null},{id:"orders",text:"Commandes",icon:(0,T.jsx)(ee.A,{}),path:"/admin/orders",show:u("orders","read")&&"productManager"!==(null===c||void 0===c?void 0:c.role),badge:{count:8,color:"error"}},{id:"statistics",text:"Statistiques",icon:(0,T.jsx)(re.A,{}),path:"/admin/statistics",show:!0,badge:null},{id:"admin-users",text:"Administrateurs",icon:(0,T.jsx)(te.A,{}),path:"/admin/admin-users",show:u("admins","read"),badge:null},{id:"profile",text:"Profil",icon:(0,T.jsx)(C.A,{}),path:"/admin/profile",show:!0,badge:null},{id:"settings",text:"Param\xe8tres",icon:(0,T.jsx)(w.A,{}),path:"/admin/settings",show:!0,badge:null}],S=b.filter((e=>e.show)),P=(0,T.jsxs)("div",{children:[(0,T.jsxs)(l.A,{sx:{py:3,px:2,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:o.palette.primary.main,color:"white"},children:[(0,T.jsx)(j.A,{alt:"Logo",src:"/logo.png",sx:{width:60,height:60,mb:1,bgcolor:"white",p:1}}),(0,T.jsx)(m.A,{variant:"h6",fontWeight:"bold",align:"center",sx:{mb:.5},children:"Admin Dashboard"}),c&&(0,T.jsx)(l.A,{sx:{mt:1,textAlign:"center"},children:(0,T.jsx)(p.A,{title:"Votre r\xf4le",children:(0,T.jsxs)(m.A,{variant:"caption",sx:{backgroundColor:"rgba(255, 255, 255, 0.15)",borderRadius:"12px",py:.5,px:1.5,display:"inline-block",fontWeight:500},children:["superAdmin"===c.role&&"Super Admin","productManager"===c.role&&"Responsable produits","orderManager"===c.role&&"Responsable commandes","contentEditor"===c.role&&"\xc9diteur de contenu"]})})})]}),(0,T.jsx)(g.A,{}),(0,T.jsx)(l.A,{sx:{p:2},children:(0,T.jsx)(D.A,{sx:{px:1},children:S.map((e=>e.subItems?(0,T.jsxs)(s.Fragment,{children:[(0,T.jsx)(R.Ay,{disablePadding:!0,sx:{mb:.5},children:(0,T.jsxs)(U.A,{onClick:()=>{return r=e.id,void A(h===r?null:r);var r},sx:{borderRadius:2,color:h===e.id?o.palette.primary.main:o.palette.text.primary,bgcolor:h===e.id?"rgba(37, 99, 235, 0.08)":"transparent"},children:[(0,T.jsx)(y.A,{sx:{color:h===e.id?o.palette.primary.main:"inherit",minWidth:40},children:e.icon}),(0,T.jsx)(f.A,{primary:e.text}),h===e.id?(0,T.jsx)(se.A,{}):(0,T.jsx)(ie.A,{})]})}),(0,T.jsx)(O.A,{in:h===e.id,timeout:"auto",unmountOnExit:!0,children:(0,T.jsx)(D.A,{component:"div",disablePadding:!0,children:e.subItems.filter((e=>e.show)).map((e=>(0,T.jsx)(R.Ay,{disablePadding:!0,sx:{pl:2,mb:.5},children:(0,T.jsxs)(U.A,{component:ne.k2,to:e.path,sx:{borderRadius:2,pl:2,color:v(e.path)?o.palette.primary.main:o.palette.text.primary,bgcolor:v(e.path)?"rgba(37, 99, 235, 0.08)":"transparent","&:hover":{bgcolor:"rgba(37, 99, 235, 0.12)"}},children:[(0,T.jsx)(y.A,{sx:{color:v(e.path)?o.palette.primary.main:"inherit",minWidth:36},children:e.icon}),(0,T.jsx)(f.A,{primary:e.text,primaryTypographyProps:{fontSize:"0.9rem"}}),e.badge&&(0,T.jsx)(d.A,{badgeContent:e.badge.count,color:e.badge.color})]})},e.id)))})})]},e.id):(0,T.jsx)(R.Ay,{disablePadding:!0,sx:{mb:.5},children:(0,T.jsxs)(U.A,{component:ne.k2,to:e.path,sx:{borderRadius:2,color:v(e.path)?o.palette.primary.main:o.palette.text.primary,bgcolor:v(e.path)?"rgba(37, 99, 235, 0.08)":"transparent","&:hover":{bgcolor:"rgba(37, 99, 235, 0.12)"}},children:[(0,T.jsx)(y.A,{sx:{color:v(e.path)?o.palette.primary.main:"inherit",minWidth:40},children:e.icon}),(0,T.jsx)(f.A,{primary:e.text}),e.badge&&(0,T.jsx)(d.A,{badgeContent:e.badge.count,color:e.badge.color})]})},e.id)))})}),(0,T.jsxs)(l.A,{sx:{mt:"auto",p:2},children:[(0,T.jsx)(g.A,{sx:{mb:2}}),(0,T.jsxs)(m.A,{variant:"caption",color:"text.secondary",sx:{px:2,display:"block"},children:["\xa9 ",(new Date).getFullYear()," Admin Dashboard",(0,T.jsx)("br",{}),"Version 1.0.0"]})]})]});return(0,T.jsxs)(l.A,{component:"nav",sx:{width:{md:n},flexShrink:{md:0}},children:[(0,T.jsx)(K.Ay,{variant:"temporary",open:r,onClose:t,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:n,boxShadow:"0 10px 30px rgba(0,0,0,0.1)"}},children:P}),(0,T.jsx)(K.Ay,{variant:"permanent",sx:{display:{xs:"none",md:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:n,borderRight:"1px solid rgba(0, 0, 0, 0.05)"}},open:!0,children:P})]})},oe=280,le=(0,n.Ay)(o.A,{shouldForwardProp:e=>"open"!==e})((e=>{let{theme:r,open:t}=e;return{transition:r.transitions.create(["margin","width"],{easing:r.transitions.easing.sharp,duration:r.transitions.duration.leavingScreen}),...t&&{[r.breakpoints.up("md")]:{width:"calc(100% - 280px)",marginLeft:oe}},boxShadow:"none",backdropFilter:"blur(6px)",backgroundColor:"rgba(255, 255, 255, 0.8)",color:r.palette.text.primary,borderBottom:`1px solid ${r.palette.divider}`}})),de=(0,n.Ay)("main",{shouldForwardProp:e=>"open"!==e})((e=>{let{theme:r,open:t}=e;return{flexGrow:1,padding:r.spacing(3),transition:r.transitions.create("margin",{easing:r.transitions.easing.sharp,duration:r.transitions.duration.leavingScreen}),...t&&{[r.breakpoints.up("md")]:{marginLeft:oe},transition:r.transitions.create("margin",{easing:r.transitions.easing.easeOut,duration:r.transitions.duration.enteringScreen})},minHeight:"100vh",display:"flex",flexDirection:"column",backgroundColor:r.palette.background.default}})),ce=(0,n.Ay)(l.A)((e=>{let{theme:r}=e;return{flex:1,width:"100%",maxWidth:"100%",margin:"0 auto",padding:r.spacing(2),[r.breakpoints.up("md")]:{padding:r.spacing(3)}}})),ue=(0,n.Ay)(d.A)((e=>{let{theme:r}=e;return{"& .MuiBadge-badge":{backgroundColor:r.palette.success.main,color:r.palette.success.main,boxShadow:`0 0 0 2px ${r.palette.background.paper}`,"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",content:'""'}}}})),xe=e=>{let{children:r}=e;const[t,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),{currentUser:P,logout:_}=(0,V.A)(),D=(0,i.Zp)(),R=(0,a.A)(),I=(0,c.A)(R.breakpoints.down("md")),k=()=>{n(!t)},E=()=>{d(null)},q=()=>P?P.firstName&&P.lastName?`${P.firstName} ${P.lastName}`:P.username:"Utilisateur",W=()=>{if(!P)return"";return{superAdmin:"Super Admin",productManager:"Responsable produits",orderManager:"Responsable commandes",contentEditor:"\xc9diteur de contenu"}[P.role]||P.role};return(0,T.jsxs)(l.A,{sx:{display:"flex"},children:[(0,T.jsx)(u.Ay,{}),(0,T.jsx)(le,{position:"fixed",open:!I&&t,children:(0,T.jsxs)(x.A,{children:[(0,T.jsx)(h.A,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:k,sx:{mr:2},children:(0,T.jsx)(b.A,{})}),(0,T.jsx)(m.A,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Dashboard Admin"}),(0,T.jsx)(l.A,{sx:{mr:1},children:(0,T.jsx)(L,{})}),(0,T.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[!I&&(0,T.jsxs)(l.A,{sx:{mr:2,textAlign:"right"},children:[(0,T.jsx)(m.A,{variant:"subtitle2",component:"div",children:q()}),(0,T.jsx)(m.A,{variant:"caption",color:"textSecondary",children:W()})]}),(0,T.jsx)(p.A,{title:"Param\xe8tres du compte",children:(0,T.jsx)(h.A,{size:"large","aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:e=>{d(e.currentTarget)},color:"inherit",children:(0,T.jsx)(ue,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",children:(0,T.jsx)(j.A,{sx:{bgcolor:R.palette.primary.main},children:P?P.firstName&&P.lastName?`${P.firstName.charAt(0)}${P.lastName.charAt(0)}`:P.username.charAt(0).toUpperCase():"U"})})})}),(0,T.jsxs)(A.A,{id:"menu-appbar",anchorEl:o,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(o),onClose:E,sx:{"& .MuiPaper-root":{borderRadius:2,minWidth:180,boxShadow:"0px 4px 20px rgba(0,0,0,0.1)"}},children:[(0,T.jsxs)(l.A,{sx:{px:2,py:1.5},children:[(0,T.jsx)(m.A,{variant:"subtitle1",fontWeight:"bold",children:q()}),(0,T.jsx)(m.A,{variant:"body2",color:"textSecondary",children:W()})]}),(0,T.jsx)(g.A,{}),(0,T.jsxs)(v.A,{onClick:()=>{E(),D("/admin/profile")},dense:!0,children:[(0,T.jsx)(y.A,{children:(0,T.jsx)(C.A,{fontSize:"small"})}),(0,T.jsx)(f.A,{children:"Profil"})]}),(0,T.jsxs)(v.A,{onClick:()=>{E(),D("/admin/settings")},dense:!0,children:[(0,T.jsx)(y.A,{children:(0,T.jsx)(w.A,{fontSize:"small"})}),(0,T.jsx)(f.A,{children:"Param\xe8tres"})]}),(0,T.jsx)(g.A,{}),(0,T.jsxs)(v.A,{onClick:()=>{E(),_()},dense:!0,children:[(0,T.jsx)(y.A,{children:(0,T.jsx)(S.A,{fontSize:"small"})}),(0,T.jsx)(f.A,{children:"D\xe9connexion"})]})]})]})]})}),(0,T.jsx)(ae,{mobileOpen:t,handleDrawerToggle:k,drawerWidth:oe}),(0,T.jsxs)(de,{open:!I&&t,children:[(0,T.jsx)(x.A,{})," ",(0,T.jsx)(ce,{children:r})]})]})};var he=t(19808),me=t(2235),pe=t(33174),je=t(29925),Ae=t(77078),ge=t(43939),ve=t(29714);const ye=ve.Ik({username:ve.Yj().required("Le nom d'utilisateur est requis"),password:ve.Yj().required("Le mot de passe est requis")});const fe=function(){var e,r;const[t,n]=(0,s.useState)(""),{login:a}=(0,V.A)(),o=(0,i.Zp)(),d=(null===(e=(0,i.zy)().state)||void 0===e||null===(r=e.from)||void 0===r?void 0:r.pathname)||"/admin/dashboard",c=(0,ge.Wx)({initialValues:{username:"",password:""},validationSchema:ye,onSubmit:async e=>{try{await a(e.username,e.password)?o(d,{replace:!0}):n("Nom d'utilisateur ou mot de passe incorrect.")}catch(r){n("Une erreur est survenue lors de la connexion.")}}});return(0,T.jsx)(he.A,{component:"main",maxWidth:"xs",children:(0,T.jsx)(l.A,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:(0,T.jsx)(me.A,{elevation:3,sx:{padding:4,width:"100%"},children:(0,T.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,T.jsx)(j.A,{sx:{m:1,bgcolor:"primary.main"},children:(0,T.jsx)(Ae.A,{})}),(0,T.jsx)(m.A,{component:"h1",variant:"h5",children:"Connexion Admin"}),t&&(0,T.jsx)(pe.A,{severity:"error",sx:{mt:2,width:"100%"},children:t}),(0,T.jsxs)(l.A,{component:"form",onSubmit:c.handleSubmit,sx:{mt:1,width:"100%"},children:[(0,T.jsx)(je.A,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Nom d'utilisateur",name:"username",autoComplete:"username",autoFocus:!0,value:c.values.username,onChange:c.handleChange,error:c.touched.username&&Boolean(c.errors.username),helperText:c.touched.username&&c.errors.username}),(0,T.jsx)(je.A,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Mot de passe",type:"password",id:"password",autoComplete:"current-password",value:c.values.password,onChange:c.handleChange,error:c.touched.password&&Boolean(c.errors.password),helperText:c.touched.password&&c.errors.password}),(0,T.jsx)(P.A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:c.isSubmitting,children:"Se connecter"})]})]})})})})};var be=t(60899),Ce=t(18274);const we=function(){const[e,r]=(0,s.useState)(null),[t,i]=(0,s.useState)(!0),[n,a]=(0,s.useState)("");return(0,s.useEffect)((()=>{(async()=>{try{const e=await B.A.get("/stats");r(e.data),i(!1)}catch(e){console.error("Erreur lors du chargement des statistiques:",e),a("Impossible de charger les statistiques."),i(!1)}})()}),[]),t?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,T.jsx)(_.A,{})}):n?(0,T.jsx)(l.A,{sx:{mt:4},children:(0,T.jsx)(m.A,{color:"error",variant:"h6",children:n})}):(0,T.jsxs)("div",{children:[(0,T.jsx)(m.A,{variant:"h4",gutterBottom:!0,children:"Tableau de bord"}),(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:4,children:(0,T.jsxs)(me.A,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:"primary.light",color:"white"},children:[(0,T.jsx)(Z.A,{sx:{fontSize:60,mb:2}}),(0,T.jsx)(m.A,{variant:"h4",children:(null===e||void 0===e?void 0:e.categories)||0}),(0,T.jsx)(m.A,{variant:"h6",children:"Cat\xe9gories"})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:4,children:(0,T.jsxs)(me.A,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:"secondary.light",color:"white"},children:[(0,T.jsx)(ee.A,{sx:{fontSize:60,mb:2}}),(0,T.jsx)(m.A,{variant:"h4",children:(null===e||void 0===e?void 0:e.products)||0}),(0,T.jsx)(m.A,{variant:"h6",children:"Produits"})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:4,children:(0,T.jsxs)(me.A,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:"success.light",color:"white"},children:[(0,T.jsx)(Ce.A,{sx:{fontSize:60,mb:2}}),(0,T.jsx)(m.A,{variant:"h4",children:(null===e||void 0===e?void 0:e.companies)||0}),(0,T.jsx)(m.A,{variant:"h6",children:"Entreprises"})]})})]}),(0,T.jsxs)(l.A,{mt:4,children:[(0,T.jsx)(m.A,{variant:"h5",gutterBottom:!0,children:"Bienvenue dans votre panneau d'administration"}),(0,T.jsx)(m.A,{variant:"body1",children:"Utilisez le menu \xe0 gauche pour g\xe9rer votre catalogue de produits, cat\xe9gories et entreprises."})]})]})};var Se=t(1320),Pe=t(15769),_e=t(69780),De=t(9213),Re=t(21671),Ie=t(34075),ke=t(96583),Ee=t(40033),qe=t(28170),We=t(79739),Ne=t(53256),Me=t(40379),$e=t(6493);const Fe=e=>{let{open:r,title:t,message:s,onConfirm:i,onCancel:n}=e;return(0,T.jsxs)(ke.A,{open:r,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,T.jsx)(Ee.A,{id:"alert-dialog-title",children:t}),(0,T.jsx)(qe.A,{children:(0,T.jsx)($e.A,{id:"alert-dialog-description",children:s})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:n,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:i,variant:"contained",color:"error",autoFocus:!0,children:"Confirmer"})]})]})},Be=e=>{let{src:r,alt:t,onDelete:s}=e;return(0,T.jsxs)(l.A,{sx:{position:"relative",width:100,height:100,m:.5,border:"1px solid #ddd",borderRadius:1,overflow:"hidden"},children:[(0,T.jsx)("img",{src:r,alt:t,style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,T.jsx)(h.A,{size:"small",sx:{position:"absolute",top:5,right:5,bgcolor:"rgba(255, 255, 255, 0.7)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},onClick:s,children:(0,T.jsx)(M.A,{color:"error"})})]})};const ze=function(){const[e,r]=(0,s.useState)([]),[t,i]=(0,s.useState)(!0),[n,a]=(0,s.useState)(!1),[o,d]=(0,s.useState)({name:"",description:""}),[c,u]=(0,s.useState)(null),[x,p]=(0,s.useState)(""),[j,A]=(0,s.useState)(!1),[g,v]=(0,s.useState)(null),[y,f]=(0,s.useState)({open:!1,id:null});(0,s.useEffect)((()=>{b()}),[]);const b=async()=>{try{i(!0);const e=await B.A.get("/categories");r(e.data),i(!1)}catch(e){console.error("Erreur lors du chargement des cat\xe9gories:",e),z.oR.error("Impossible de charger les cat\xe9gories"),i(!1)}},C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(d({name:e.name,description:e.description||""}),p(e.logo||""),A(!0),v(e._id)):(d({name:"",description:""}),u(null),p(""),A(!1),v(null)),a(!0)},w=()=>{a(!1),d({name:"",description:""}),u(null),p("")},S=e=>{const{name:r,value:t}=e.target;d({...o,[r]:t})};return t?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,T.jsx)(_.A,{})}):(0,T.jsxs)("div",{children:[(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,T.jsx)(m.A,{variant:"h4",children:"Gestion des Cat\xe9gories"}),(0,T.jsx)(P.A,{variant:"contained",startIcon:(0,T.jsx)(Ne.A,{}),onClick:()=>C(),children:"Ajouter une cat\xe9gorie"})]}),(0,T.jsx)(Se.A,{component:me.A,children:(0,T.jsxs)(Pe.A,{children:[(0,T.jsx)(_e.A,{children:(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:"Image"}),(0,T.jsx)(Re.A,{children:"Nom"}),(0,T.jsx)(Re.A,{children:"Description"}),(0,T.jsx)(Re.A,{children:"Actions"})]})}),(0,T.jsx)(Ie.A,{children:e.length>0?e.map((e=>(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:(0,T.jsx)(l.A,{sx:{width:60,height:60},children:e.logo?(0,T.jsx)("img",{src:e.logo,alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}):(0,T.jsx)(l.A,{sx:{width:"100%",height:"100%",bgcolor:"grey.200",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"},children:(0,T.jsx)(m.A,{variant:"caption",children:"No image"})})})}),(0,T.jsx)(Re.A,{children:e.name}),(0,T.jsx)(Re.A,{children:e.description||"-"}),(0,T.jsxs)(Re.A,{children:[(0,T.jsx)(h.A,{onClick:()=>C(e),children:(0,T.jsx)(Me.A,{})}),(0,T.jsx)(h.A,{onClick:()=>{return r=e._id,void f({open:!0,id:r});var r},children:(0,T.jsx)(M.A,{color:"error"})})]})]},e._id))):(0,T.jsx)(De.A,{children:(0,T.jsx)(Re.A,{colSpan:4,align:"center",children:"Aucune cat\xe9gorie trouv\xe9e"})})})]})}),(0,T.jsxs)(ke.A,{open:n,onClose:w,children:[(0,T.jsx)(Ee.A,{children:j?"Modifier la cat\xe9gorie":"Ajouter une cat\xe9gorie"}),(0,T.jsx)(qe.A,{children:(0,T.jsxs)(be.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"name",label:"Nom",fullWidth:!0,value:o.name,onChange:S,required:!0})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"description",label:"Description",fullWidth:!0,multiline:!0,rows:3,value:o.description,onChange:S})}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)("input",{accept:"image/*",style:{display:"none"},id:"logo-upload",type:"file",onChange:e=>{e.target.files&&e.target.files[0]&&(u(e.target.files[0]),p(URL.createObjectURL(e.target.files[0])))}}),(0,T.jsx)("label",{htmlFor:"logo-upload",children:(0,T.jsx)(P.A,{variant:"outlined",component:"span",children:j?"Changer l'image":"Ajouter une image"})}),(0,T.jsx)(l.A,{sx:{mt:2},children:x&&(0,T.jsx)(Be,{src:x,alt:"Aper\xe7u de l'image",onDelete:()=>{u(null),p("")}})})]})]})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:w,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:async()=>{try{const e=new FormData;e.append("name",o.name),e.append("description",o.description),c&&e.append("logo",c),j?(await B.A.put(`/categories/${g}`,e),z.oR.success("Cat\xe9gorie mise \xe0 jour avec succ\xe8s")):(await B.A.post("/categories",e),z.oR.success("Cat\xe9gorie cr\xe9\xe9e avec succ\xe8s")),w(),b()}catch(e){console.error("Erreur lors de l'enregistrement de la cat\xe9gorie:",e),z.oR.error("Erreur lors de l'enregistrement de la cat\xe9gorie")}},variant:"contained",disabled:!o.name,children:j?"Mettre \xe0 jour":"Ajouter"})]})]}),(0,T.jsx)(Fe,{open:y.open,title:"Confirmer la suppression",message:"\xcates-vous s\xfbr de vouloir supprimer cette cat\xe9gorie? Cette action est irr\xe9versible.",onConfirm:async()=>{try{await B.A.delete(`/categories/${y.id}`),z.oR.success("Cat\xe9gorie supprim\xe9e avec succ\xe8s"),b()}catch(e){console.error("Erreur lors de la suppression de la cat\xe9gorie:",e),z.oR.error("Erreur lors de la suppression de la cat\xe9gorie")}finally{f({open:!1,id:null})}},onCancel:()=>f({open:!1,id:null})})]})};const Te=function(){const[e,r]=(0,s.useState)([]),[t,i]=(0,s.useState)([]),[n,a]=(0,s.useState)(!0),[o,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)({name:"",categories_id:""}),[x,p]=(0,s.useState)(!1),[j,A]=(0,s.useState)(null),[g,y]=(0,s.useState)({open:!1,id:null});(0,s.useEffect)((()=>{f(),b()}),[]);const f=async()=>{try{const e=await B.A.get("/subcategories");r(e.data),a(!1)}catch(e){console.error("Erreur lors du chargement des sous-cat\xe9gories:",e),z.oR.error("Impossible de charger les sous-cat\xe9gories"),a(!1)}},b=async()=>{try{const e=await B.A.get("/categories");i(e.data)}catch(e){console.error("Erreur lors du chargement des cat\xe9gories:",e),z.oR.error("Impossible de charger les cat\xe9gories")}},C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(u({name:e.name,categories_id:e.categories_id._id||e.categories_id}),p(!0),A(e._id)):(u({name:"",categories_id:""}),p(!1),A(null)),d(!0)},w=()=>{d(!1),u({name:"",categories_id:""})},S=e=>{const{name:r,value:t}=e.target;u({...c,[r]:t})};return n?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,T.jsx)(_.A,{})}):(0,T.jsxs)("div",{children:[(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,T.jsx)(m.A,{variant:"h4",children:"Gestion des Sous-cat\xe9gories"}),(0,T.jsx)(P.A,{variant:"contained",startIcon:(0,T.jsx)(Ne.A,{}),onClick:()=>C(),children:"Ajouter une sous-cat\xe9gorie"})]}),(0,T.jsx)(Se.A,{component:me.A,children:(0,T.jsxs)(Pe.A,{children:[(0,T.jsx)(_e.A,{children:(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:"Nom"}),(0,T.jsx)(Re.A,{children:"Cat\xe9gorie Parente"}),(0,T.jsx)(Re.A,{children:"Actions"})]})}),(0,T.jsx)(Ie.A,{children:e.length>0?e.map((e=>(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:e.name}),(0,T.jsx)(Re.A,{children:e.categories_id&&e.categories_id.name?e.categories_id.name:"Non sp\xe9cifi\xe9"}),(0,T.jsxs)(Re.A,{children:[(0,T.jsx)(h.A,{onClick:()=>C(e),children:(0,T.jsx)(Me.A,{})}),(0,T.jsx)(h.A,{onClick:()=>{return r=e._id,void y({open:!0,id:r});var r},children:(0,T.jsx)(M.A,{color:"error"})})]})]},e._id))):(0,T.jsx)(De.A,{children:(0,T.jsx)(Re.A,{colSpan:3,align:"center",children:"Aucune sous-cat\xe9gorie trouv\xe9e"})})})]})}),(0,T.jsxs)(ke.A,{open:o,onClose:w,children:[(0,T.jsx)(Ee.A,{children:x?"Modifier la sous-cat\xe9gorie":"Ajouter une sous-cat\xe9gorie"}),(0,T.jsx)(qe.A,{children:(0,T.jsxs)(be.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"name",label:"Nom",fullWidth:!0,value:c.name,onChange:S,required:!0})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{select:!0,name:"categories_id",label:"Cat\xe9gorie parente",fullWidth:!0,value:c.categories_id,onChange:S,required:!0,children:t.map((e=>(0,T.jsx)(v.A,{value:e._id,children:e.name},e._id)))})})]})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:w,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:async()=>{try{x?(await B.A.put(`/subcategories/${j}`,c),z.oR.success("Sous-cat\xe9gorie mise \xe0 jour avec succ\xe8s")):(await B.A.post("/subcategories",c),z.oR.success("Sous-cat\xe9gorie cr\xe9\xe9e avec succ\xe8s")),w(),f()}catch(e){console.error("Erreur lors de l'enregistrement de la sous-cat\xe9gorie:",e),z.oR.error("Erreur lors de l'enregistrement de la sous-cat\xe9gorie")}},variant:"contained",disabled:!c.name||!c.categories_id,children:x?"Mettre \xe0 jour":"Ajouter"})]})]}),(0,T.jsx)(Fe,{open:g.open,title:"Confirmer la suppression",message:"\xcates-vous s\xfbr de vouloir supprimer cette sous-cat\xe9gorie? Cette action est irr\xe9versible.",onConfirm:async()=>{try{await B.A.delete(`/subcategories/${g.id}`),z.oR.success("Sous-cat\xe9gorie supprim\xe9e avec succ\xe8s"),f()}catch(e){console.error("Erreur lors de la suppression de la sous-cat\xe9gorie:",e),z.oR.error("Erreur lors de la suppression de la sous-cat\xe9gorie")}finally{y({open:!1,id:null})}},onCancel:()=>y({open:!1,id:null})})]})};var Le=t(25277),Ve=t(25979),Ue=t(3788),Oe=t(16101),Ke=t(3198);const Ge=function(){const[e,r]=(0,s.useState)([]),[t,i]=(0,s.useState)([]),[n,a]=(0,s.useState)([]),[o,d]=(0,s.useState)(!0),[c,u]=(0,s.useState)(!1),[x,p]=(0,s.useState)({nom:"",categories_id:[],subcategories_id:[]}),[j,A]=(0,s.useState)(null),[g,y]=(0,s.useState)(""),[f,b]=(0,s.useState)(!1),[C,w]=(0,s.useState)(null),[S,D]=(0,s.useState)({open:!1,id:null}),[R,I]=(0,s.useState)([]);(0,s.useEffect)((()=>{k(),E(),q()}),[]),(0,s.useEffect)((()=>{if(x.categories_id&&x.categories_id.length>0){const e=n.filter((e=>{var r;if(!e||!e.categories_id)return!1;const t="object"===typeof e.categories_id?null===(r=e.categories_id)||void 0===r?void 0:r._id:e.categories_id;return t&&x.categories_id.includes(t)}));I(e)}else I([])}),[x.categories_id,n]);const k=async()=>{try{const e=await B.A.get("/companies");r(e.data),d(!1)}catch(e){console.error("Erreur lors du chargement des entreprises:",e),z.oR.error("Impossible de charger les entreprises"),d(!1)}},E=async()=>{try{const e=await B.A.get("/categories");i(e.data)}catch(e){console.error("Erreur lors du chargement des cat\xe9gories:",e),z.oR.error("Impossible de charger les cat\xe9gories")}},q=async()=>{try{const e=await B.A.get("/subcategories");a(e.data)}catch(e){console.error("Erreur lors du chargement des sous-cat\xe9gories:",e),z.oR.error("Impossible de charger les sous-cat\xe9gories")}},W=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){const r=e.categories_id.map((e=>"object"===typeof e?e._id:e)),t=e.subcategories_id.map((e=>"object"===typeof e?e._id:e));p({nom:e.nom,categories_id:r,subcategories_id:t}),y(e.logo||""),b(!0),w(e._id)}else p({nom:"",categories_id:[],subcategories_id:[]}),A(null),y(""),b(!1),w(null);u(!0)},N=()=>{u(!1),p({nom:"",categories_id:[],subcategories_id:[]}),A(null),y("")},$=e=>{const{name:r,value:t}=e.target;p({...x,[r]:t})};return o?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,T.jsx)(_.A,{})}):(0,T.jsxs)("div",{children:[(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,T.jsx)(m.A,{variant:"h4",children:"Gestion des Entreprises"}),(0,T.jsx)(P.A,{variant:"contained",startIcon:(0,T.jsx)(Ne.A,{}),onClick:()=>W(),children:"Ajouter une entreprise"})]}),(0,T.jsx)(Se.A,{component:me.A,children:(0,T.jsxs)(Pe.A,{children:[(0,T.jsx)(_e.A,{children:(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:"Logo"}),(0,T.jsx)(Re.A,{children:"Nom"}),(0,T.jsx)(Re.A,{children:"Cat\xe9gories"}),(0,T.jsx)(Re.A,{children:"Sous-cat\xe9gories"}),(0,T.jsx)(Re.A,{children:"Actions"})]})}),(0,T.jsx)(Ie.A,{children:e.length>0?e.map((e=>(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:(0,T.jsx)(l.A,{sx:{width:60,height:60},children:e.logo?(0,T.jsx)("img",{src:e.logo,alt:e.nom,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}):(0,T.jsx)(l.A,{sx:{width:"100%",height:"100%",bgcolor:"grey.200",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"},children:(0,T.jsx)(m.A,{variant:"caption",children:"No logo"})})})}),(0,T.jsx)(Re.A,{children:e.nom}),(0,T.jsx)(Re.A,{children:(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.categories_id.map((e=>(0,T.jsx)(Le.A,{label:e.name,size:"small",color:"primary",variant:"outlined"},e._id)))})}),(0,T.jsx)(Re.A,{children:(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.subcategories_id.map((e=>(0,T.jsx)(Le.A,{label:e.name,size:"small",color:"secondary",variant:"outlined"},e._id)))})}),(0,T.jsxs)(Re.A,{children:[(0,T.jsx)(h.A,{onClick:()=>W(e),children:(0,T.jsx)(Me.A,{})}),(0,T.jsx)(h.A,{onClick:()=>{return r=e._id,void D({open:!0,id:r});var r},children:(0,T.jsx)(M.A,{color:"error"})})]})]},e._id))):(0,T.jsx)(De.A,{children:(0,T.jsx)(Re.A,{colSpan:5,align:"center",children:"Aucune entreprise trouv\xe9e"})})})]})}),(0,T.jsxs)(ke.A,{open:c,onClose:N,maxWidth:"md",fullWidth:!0,children:[(0,T.jsx)(Ee.A,{children:f?"Modifier l'entreprise":"Ajouter une entreprise"}),(0,T.jsx)(qe.A,{children:(0,T.jsxs)(be.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"nom",label:"Nom de l'entreprise",fullWidth:!0,value:x.nom,onChange:$,required:!0})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,children:[(0,T.jsx)(Ue.A,{id:"categories-label",children:"Cat\xe9gories"}),(0,T.jsx)(Oe.A,{labelId:"categories-label",multiple:!0,name:"categories_id",value:x.categories_id,onChange:$,input:(0,T.jsx)(Ke.A,{label:"Cat\xe9gories"}),renderValue:e=>(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e=>{const r=t.find((r=>r._id===e));return r?(0,T.jsx)(Le.A,{label:r.name},e):null}))}),children:t.map((e=>(0,T.jsx)(v.A,{value:e._id,children:e.name},e._id)))})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,children:[(0,T.jsx)(Ue.A,{id:"subcategories-label",children:"Sous-cat\xe9gories"}),(0,T.jsx)(Oe.A,{labelId:"subcategories-label",multiple:!0,name:"subcategories_id",value:x.subcategories_id,onChange:$,input:(0,T.jsx)(Ke.A,{label:"Sous-cat\xe9gories"}),renderValue:e=>(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e=>{const r=n.find((r=>r._id===e));return r?(0,T.jsx)(Le.A,{label:r.name},e):null}))}),disabled:0===x.categories_id.length,children:R.map((e=>(0,T.jsx)(v.A,{value:e._id,children:e.name},e._id)))})]})}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)("input",{accept:"image/*",style:{display:"none"},id:"logo-upload",type:"file",onChange:e=>{e.target.files&&e.target.files[0]&&(A(e.target.files[0]),y(URL.createObjectURL(e.target.files[0])))}}),(0,T.jsx)("label",{htmlFor:"logo-upload",children:(0,T.jsx)(P.A,{variant:"outlined",component:"span",children:f?"Changer le logo":"Ajouter un logo"})}),(0,T.jsx)(l.A,{sx:{mt:2},children:g&&(0,T.jsx)(Be,{src:g,alt:"Aper\xe7u du logo",onDelete:()=>{A(null),y("")}})})]})]})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:N,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:async()=>{try{const e=new FormData;e.append("nom",x.nom),x.categories_id.forEach((r=>{e.append("categories_id",r)})),x.subcategories_id.forEach((r=>{e.append("subcategories_id",r)})),j&&e.append("logo",j),f?(await B.A.put(`/companies/${C}`,e),z.oR.success("Entreprise mise \xe0 jour avec succ\xe8s")):(await B.A.post("/companies",e),z.oR.success("Entreprise cr\xe9\xe9e avec succ\xe8s")),N(),k()}catch(e){console.error("Erreur lors de l'enregistrement de l'entreprise:",e),z.oR.error("Erreur lors de l'enregistrement de l'entreprise")}},variant:"contained",disabled:!x.nom||0===x.categories_id.length,children:f?"Mettre \xe0 jour":"Ajouter"})]})]}),(0,T.jsx)(Fe,{open:S.open,title:"Confirmer la suppression",message:"\xcates-vous s\xfbr de vouloir supprimer cette entreprise? Cette action est irr\xe9versible.",onConfirm:async()=>{try{await B.A.delete(`/companies/${S.id}`),z.oR.success("Entreprise supprim\xe9e avec succ\xe8s"),k()}catch(e){console.error("Erreur lors de la suppression de l'entreprise:",e),z.oR.error("Erreur lors de la suppression de l'entreprise")}finally{D({open:!1,id:null})}},onCancel:()=>D({open:!1,id:null})})]})};var He=t(82825);const Qe=()=>{const[e,r]=(0,s.useState)([]),[t,i]=(0,s.useState)([]),[n,a]=(0,s.useState)([]),[o,l]=(0,s.useState)([]),[d,c]=(0,s.useState)([]),[u,x]=(0,s.useState)(null),[h,m]=(0,s.useState)({nom:"",description:"",features:"",oldPrice:"",quantite:"0",Company_id:"",categoriesa_id:[],subcategories_id:[],productType:"simple"}),[p,j]=(0,s.useState)({discountedPrice:"",discountDuration:""}),[A,g]=(0,s.useState)([]),[v,y]=(0,s.useState)([]),[f,b]=(0,s.useState)(1),[C]=(0,s.useState)(5),[w,S]=(0,s.useState)(1),[P,_]=(0,s.useState)(!1),[D,R]=(0,s.useState)(!1),[I,k]=(0,s.useState)(!1),[E,q]=(0,s.useState)({open:!1,id:null}),[W,N]=(0,s.useState)({open:!1,id:null}),[M,F]=(0,s.useState)(!1),[T,L]=(0,s.useState)(null),[V,U]=(0,s.useState)(!0);(0,s.useEffect)((()=>{O()}),[f]),(0,s.useEffect)((()=>{K(),G(),H()}),[]),(0,s.useEffect)((()=>{if(h.categoriesa_id&&h.categoriesa_id.length>0){const e=n.filter((e=>{var r;const t=(null===(r=e.categories_id)||void 0===r?void 0:r._id)||e.categories_id;return t&&h.categoriesa_id.includes(t)}));c(e)}else c([])}),[h.categoriesa_id,n]);const O=async()=>{try{U(!0);const e=await B.A.get("/products");r(e.data),S(Math.ceil(e.data.length/C)),U(!1)}catch(e){console.error("Erreur lors du chargement des produits:",e),z.oR.error("Impossible de charger les produits"),U(!1)}},K=async()=>{try{const e=await B.A.get("/categories");i(e.data)}catch(e){console.error("Erreur lors du chargement des cat\xe9gories:",e),z.oR.error("Impossible de charger les cat\xe9gories")}},G=async()=>{try{const e=await B.A.get("/subcategories");a(e.data)}catch(e){console.error("Erreur lors du chargement des sous-cat\xe9gories:",e),z.oR.error("Impossible de charger les sous-cat\xe9gories")}},H=async()=>{try{const e=await B.A.get("/companies");l(e.data)}catch(e){console.error("Erreur lors du chargement des entreprises:",e),z.oR.error("Impossible de charger les entreprises")}},Q=()=>{_(!1),m({nom:"",description:"",features:"",oldPrice:"",quantite:"0",Company_id:"",categoriesa_id:[],subcategories_id:[],productType:"simple"}),g([]),y([])},Z=()=>{R(!1),j({discountedPrice:"",discountDuration:""})},Y=(0,s.useMemo)((()=>e.slice((f-1)*C,f*C)),[e,f,C]);return{products:e,categories:t,subcategories:n,companies:o,paginatedProducts:Y,formData:h,discountData:p,selectedImages:A,imagePreviews:v,loading:V,page:f,totalPages:w,availableSubcategories:d,openDialog:P,openDiscountDialog:D,openImageDialog:I,confirmDialog:E,confirmDiscountRemovalDialog:W,editMode:M,selectedProduct:u,fetchProducts:O,fetchCategories:K,fetchSubcategories:G,fetchCompanies:H,handleOpenDialog:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){const r=e.categoriesa_id.map((e=>"object"===typeof e?e._id:e)),t=e.subcategories_id.map((e=>"object"===typeof e?e._id:e));m({nom:e.nom,description:e.description||"",features:e.features||"",oldPrice:e.oldPrice.toString(),quantite:void 0!==e.quantite&&null!==e.quantite?e.quantite.toString():"0",Company_id:e.Company_id._id||e.Company_id,categoriesa_id:r,subcategories_id:t,productType:e.productType||"simple"}),y(e.pictures||[]),F(!0),L(e._id)}else m({nom:"",description:"",features:"",oldPrice:"",quantite:"0",Company_id:"",categoriesa_id:[],subcategories_id:[],productType:"simple"}),g([]),y([]),F(!1),L(null);_(!0)},handleOpenDiscountDialog:e=>{var r;L(e._id),j({discountedPrice:(null===(r=e.discountedPrice)||void 0===r?void 0:r.toString())||"",discountDuration:e.discountDuration?(0,$.A)(new Date(e.discountDuration),"yyyy-MM-dd"):(0,$.A)(new Date(Date.now()+6048e5),"yyyy-MM-dd")}),R(!0)},handleOpenImageDialog:e=>{x(e),y(e.pictures||[]),k(!0)},handleCloseDialog:Q,handleCloseDiscountDialog:Z,handleCloseImageDialog:()=>{k(!1),x(null),g([])},handleInputChange:e=>{const{name:r,value:t}=e.target;m({...h,[r]:t})},handleDiscountInputChange:e=>{const{name:r,value:t}=e.target;j({...p,[r]:t})},handleImageChange:e=>{if(e.target.files){const r=Array.from(e.target.files);g([...A,...r]);const t=r.map((e=>URL.createObjectURL(e)));y([...v,...t])}},handleRemoveImage:e=>{const r=[...A];r.splice(e,1),g(r);const t=[...v];t.splice(e,1),y(t)},handleRemoveServerImage:async(e,r)=>{try{await B.A.delete(`/products/${e}/image/${r}`),z.oR.success("Image supprim\xe9e avec succ\xe8s");const t=[...v];t.splice(r,1),y(t),O()}catch(t){console.error("Erreur lors de la suppression de l'image:",t),z.oR.error("Erreur lors de la suppression de l'image")}},handleSubmit:async()=>{try{const e=new FormData;let r;return e.append("nom",h.nom),e.append("description",h.description),e.append("features",h.features),e.append("oldPrice",h.oldPrice),e.append("productType",h.productType),"simple"===h.productType&&e.append("quantite",h.quantite),e.append("Company_id",h.Company_id),h.categoriesa_id.forEach((r=>{e.append("categoriesa_id",r)})),h.subcategories_id.forEach((r=>{e.append("subcategories_id",r)})),A.forEach((r=>{e.append("pictures",r)})),M?(r=await B.A.put(`/products/${T}`,e),z.oR.success("Produit mis \xe0 jour avec succ\xe8s")):(r=await B.A.post("/products",e),z.oR.success("Produit cr\xe9\xe9 avec succ\xe8s")),Q(),O(),{success:!0,data:r.data}}catch(t){var e,r;return console.error("Erreur lors de l'enregistrement du produit:",t),z.oR.error("Erreur lors de l'enregistrement du produit: "+((null===(e=t.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.message)||t.message)),{success:!1,error:t}}},handleSubmitDiscount:async()=>{try{return await B.A.put(`/products/${T}/discount`,p),z.oR.success("Remise appliqu\xe9e avec succ\xe8s"),Z(),O(),{success:!0}}catch(e){return console.error("Erreur lors de l'application de la remise:",e),z.oR.error("Erreur lors de l'application de la remise"),{success:!1,error:e}}},handleDeleteClick:e=>{q({open:!0,id:e})},handleConfirmDelete:async()=>{try{return await B.A.delete(`/products/${E.id}`),z.oR.success("Produit supprim\xe9 avec succ\xe8s"),O(),q({open:!1,id:null}),{success:!0}}catch(e){return console.error("Erreur lors de la suppression du produit:",e),z.oR.error("Erreur lors de la suppression du produit"),q({open:!1,id:null}),{success:!1,error:e}}},handleRemoveDiscountClick:e=>{N({open:!0,id:e})},handleConfirmRemoveDiscount:async()=>{try{return await B.A.delete(`/products/${W.id}/discount`),z.oR.success("Remise supprim\xe9e avec succ\xe8s"),O(),N({open:!1,id:null}),{success:!0}}catch(e){return console.error("Erreur lors de la suppression de la remise:",e),z.oR.error("Erreur lors de la suppression de la remise"),N({open:!1,id:null}),{success:!1,error:e}}},handleChangePage:(e,r)=>{b(r)},saveProductImages:async(e,r)=>{if(r.length>0&&e){const s=new FormData;r.forEach((e=>{s.append("pictures",e)}));try{return await B.A.put(`/products/${e}`,s),z.oR.success("Images mises \xe0 jour avec succ\xe8s"),{success:!0}}catch(t){return console.error("Erreur lors de l'ajout d'images:",t),z.oR.error("Erreur lors de l'ajout d'images"),{success:!1,error:t}}}return{success:!0}},setFormData:m,setConfirmDialog:q,setConfirmDiscountRemovalDialog:N,setSelectedImages:g,setImagePreviews:y,setSelectedProduct:x}};var Ze=t(48089),Ye=t(13569),Je=t(50704),Xe=t(43315),er=t(76812);const rr=e=>{var r,t,s,n;let{product:a,onEdit:o,onDelete:d,onManageImages:c,onManageDiscount:u,onRemoveDiscount:x}=e;const j=(0,i.Zp)();return(0,T.jsxs)(Ze.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,T.jsx)(Ye.A,{component:"img",height:"140",image:a.mainPicture||"/placeholder-image.jpg",alt:a.nom}),(0,T.jsxs)(Je.A,{sx:{flexGrow:1},children:[(0,T.jsx)(m.A,{gutterBottom:!0,variant:"h6",component:"div",children:a.nom}),(0,T.jsxs)(m.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[null===(r=a.description)||void 0===r?void 0:r.substring(0,100),(null===(t=a.description)||void 0===t?void 0:t.length)>100?"...":""]}),(0,T.jsxs)(be.Ay,{container:!0,spacing:1,children:[(0,T.jsx)(be.Ay,{item:!0,xs:6,children:(0,T.jsxs)(m.A,{variant:"body2",children:[(0,T.jsx)("strong",{children:"Prix:"})," ",a.oldPrice," \u20ac"]})}),(0,T.jsx)(be.Ay,{item:!0,xs:6,children:(0,T.jsxs)(m.A,{variant:"body2",children:[(0,T.jsx)("strong",{children:"Stock:"})," ",a.quantite]})}),a.discountedPrice&&(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(m.A,{variant:"body2",color:"error",children:[(0,T.jsx)("strong",{children:"Prix r\xe9duit:"})," ",a.discountedPrice," \u20ac",a.discountDuration&&(0,T.jsxs)("span",{children:[" (jusqu'au ",(0,$.A)(new Date(a.discountDuration),"dd/MM/yyyy"),")"]})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(m.A,{variant:"body2",children:[(0,T.jsx)("strong",{children:"Entreprise:"})," ",(null===(s=a.Company_id)||void 0===s?void 0:s.nom)||"N/A"]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:null===(n=a.categoriesa_id)||void 0===n?void 0:n.map((e=>(0,T.jsx)(Le.A,{label:(null===e||void 0===e?void 0:e.name)||"N/A",size:"small",color:"primary",variant:"outlined"},(null===e||void 0===e?void 0:e._id)||`temp-${Math.random()}`)))})})]})]}),(0,T.jsxs)(l.A,{sx:{p:2,display:"flex",justifyContent:"space-between"},children:[(0,T.jsxs)(l.A,{children:[(0,T.jsx)(p.A,{title:"Modifier",children:(0,T.jsx)(h.A,{onClick:()=>j(`/admin/products/edit/${a._id}`),children:(0,T.jsx)(Me.A,{})})}),"variable"===a.productType&&(0,T.jsx)(p.A,{title:"Produit variable",children:(0,T.jsx)(h.A,{color:"secondary",children:(0,T.jsx)(Z.A,{})})}),(0,T.jsx)(p.A,{title:"Supprimer",children:(0,T.jsx)(h.A,{onClick:()=>d(a._id),children:(0,T.jsx)(M.A,{color:"error"})})})]}),(0,T.jsxs)(l.A,{children:[(0,T.jsx)(p.A,{title:"G\xe9rer les images",children:(0,T.jsx)(h.A,{onClick:()=>c(a),children:(0,T.jsx)(Xe.A,{color:"primary"})})}),(0,T.jsx)(p.A,{title:a.discountedPrice?"Modifier la remise":"Ajouter une remise",children:(0,T.jsx)(h.A,{onClick:()=>u(a),children:(0,T.jsx)(X.A,{color:a.discountedPrice?"error":"action"})})}),a.discountedPrice&&(0,T.jsx)(p.A,{title:"Supprimer la remise",children:(0,T.jsx)(h.A,{onClick:()=>x(a._id),children:(0,T.jsx)(er.A,{color:"error"})})})]})]})]})};var tr=t(2046);const sr=e=>{let{open:r,onClose:t,formData:s,onChange:i,onSubmit:n,categories:a,companies:o,availableSubcategories:d,imagePreviews:c,onImageChange:u,onRemoveImage:x,editMode:h}=e;return(0,T.jsxs)(ke.A,{open:r,onClose:t,maxWidth:"md",fullWidth:!0,children:[(0,T.jsx)(Ee.A,{children:h?"Modifier le produit":"Ajouter un produit"}),(0,T.jsx)(qe.A,{children:(0,T.jsxs)(be.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{name:"nom",label:"Nom du produit",fullWidth:!0,value:s.nom,onChange:i,required:!0})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,children:[(0,T.jsx)(Ue.A,{id:"company-label",children:"Entreprise"}),(0,T.jsx)(Oe.A,{labelId:"company-label",name:"Company_id",value:s.Company_id,onChange:i,required:!0,children:o.map((e=>(0,T.jsx)(v.A,{value:e._id,children:e.nom},e._id)))})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{name:"oldPrice",label:"Prix (\u20ac)",fullWidth:!0,type:"number",InputProps:{startAdornment:(0,T.jsx)(tr.A,{position:"start",children:"\u20ac"})},value:s.oldPrice,onChange:i,required:!0})}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsxs)(Ve.A,{fullWidth:!0,margin:"normal",children:[(0,T.jsx)(Ue.A,{id:"product-type-label",children:"Type de produit"}),(0,T.jsxs)(Oe.A,{labelId:"product-type-label",name:"productType",value:s.productType,onChange:i,children:[(0,T.jsx)(v.A,{value:"simple",children:"Produit simple"}),(0,T.jsx)(v.A,{value:"variable",children:"Produit variable (avec couleurs, tailles, etc.)"})]})]}),(0,T.jsx)(m.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"simple"===s.productType?"Un produit simple est un produit unique avec un seul prix et une seule quantit\xe9 en stock.":"Un produit variable vous permet de d\xe9finir des variations (couleurs, tailles, etc.) avec des stocks et prix sp\xe9cifiques."})]}),"simple"===s.productType&&(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{name:"quantite",label:"Quantit\xe9 en stock",fullWidth:!0,type:"number",value:s.quantite||"0",onChange:i,InputProps:{inputProps:{min:0}}})}),"variable"===s.productType&&(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(pe.A,{severity:"info",sx:{mt:1},children:"Les variations de produit pourront \xeatre ajout\xe9es apr\xe8s la cr\xe9ation du produit."})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"description",label:"Description",fullWidth:!0,multiline:!0,rows:3,value:s.description,onChange:i})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"features",label:"Caract\xe9ristiques",fullWidth:!0,multiline:!0,rows:2,value:s.features,onChange:i})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,children:[(0,T.jsx)(Ue.A,{id:"categories-label",children:"Cat\xe9gories"}),(0,T.jsx)(Oe.A,{labelId:"categories-label",multiple:!0,name:"categoriesa_id",value:s.categoriesa_id,onChange:i,input:(0,T.jsx)(Ke.A,{label:"Cat\xe9gories"}),renderValue:e=>(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e=>{const r=a.find((r=>r._id===e));return r?(0,T.jsx)(Le.A,{label:r.name},e):null}))}),children:a.map((e=>(0,T.jsx)(v.A,{value:e._id,children:e.name},e._id)))})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,children:[(0,T.jsx)(Ue.A,{id:"subcategories-label",children:"Sous-cat\xe9gories"}),(0,T.jsx)(Oe.A,{labelId:"subcategories-label",multiple:!0,name:"subcategories_id",value:s.subcategories_id,onChange:i,input:(0,T.jsx)(Ke.A,{label:"Sous-cat\xe9gories"}),renderValue:e=>(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e=>{const r=d.find((r=>r._id===e));return r?(0,T.jsx)(Le.A,{label:r.name},e):null}))}),disabled:0===s.categoriesa_id.length,children:d.map((e=>(0,T.jsx)(v.A,{value:e._id,children:e.name},e._id)))})]})}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)("input",{accept:"image/*",style:{display:"none"},id:"images-upload",type:"file",multiple:!0,onChange:u}),(0,T.jsx)("label",{htmlFor:"images-upload",children:(0,T.jsx)(P.A,{variant:"outlined",component:"span",children:h?"Ajouter des images":"Uploader des images"})}),(0,T.jsx)(l.A,{sx:{mt:2,display:"flex",flexWrap:"wrap"},children:c.map(((e,r)=>(0,T.jsx)(Be,{src:e,alt:`Preview ${r}`,onDelete:()=>x(r)},r)))})]})]})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:t,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:n,variant:"contained",disabled:!s.nom||!s.oldPrice||!s.Company_id||0===s.categoriesa_id.length,children:h?"Mettre \xe0 jour":"Ajouter"})]})]})},ir=e=>{let{open:r,onClose:t,discountData:s,onChange:i,onSubmit:n}=e;return(0,T.jsxs)(ke.A,{open:r,onClose:t,children:[(0,T.jsx)(Ee.A,{children:"G\xe9rer la remise"}),(0,T.jsx)(qe.A,{children:(0,T.jsxs)(be.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"discountedPrice",label:"Prix remis\xe9 (\u20ac)",fullWidth:!0,type:"number",InputProps:{startAdornment:(0,T.jsx)(tr.A,{position:"start",children:"\u20ac"})},value:s.discountedPrice,onChange:i,required:!0})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"discountDuration",label:"Valable jusqu'au",type:"date",fullWidth:!0,value:s.discountDuration,onChange:i,InputLabelProps:{shrink:!0}})})]})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:t,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:n,variant:"contained",disabled:!s.discountedPrice,children:"Appliquer la remise"})]})]})},nr=e=>{let{open:r,onClose:t,product:s,selectedImages:i,onImageChange:n,onRemoveImage:a,onRemoveServerImage:o,onSave:d}=e;return s?(0,T.jsxs)(ke.A,{open:r,onClose:t,maxWidth:"md",children:[(0,T.jsx)(Ee.A,{children:"G\xe9rer les images du produit"}),(0,T.jsx)(qe.A,{children:(0,T.jsxs)(be.Ay,{container:!0,spacing:2,children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Images actuelles"}),(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s&&s.pictures&&s.pictures.length>0?s.pictures.map(((e,r)=>(0,T.jsxs)(l.A,{sx:{position:"relative",width:150,height:150,border:"1px solid #ddd",borderRadius:1,overflow:"hidden",mb:2},children:[(0,T.jsx)("img",{src:e,alt:`Image ${r}`,style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,T.jsx)(h.A,{size:"small",sx:{position:"absolute",top:5,right:5,bgcolor:"rgba(255, 255, 255, 0.7)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},onClick:()=>o(s._id,r),children:(0,T.jsx)(M.A,{color:"error"})}),e===s.mainPicture&&(0,T.jsx)(l.A,{sx:{position:"absolute",bottom:0,left:0,right:0,bgcolor:"primary.main",color:"white",textAlign:"center",py:.5},children:(0,T.jsx)(m.A,{variant:"caption",children:"Principale"})})]},r))):(0,T.jsx)(m.A,{variant:"body2",children:"Aucune image disponible"})})]}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Ajouter de nouvelles images"}),(0,T.jsx)("input",{accept:"image/*",style:{display:"none"},id:"add-more-images",type:"file",multiple:!0,onChange:n}),(0,T.jsx)("label",{htmlFor:"add-more-images",children:(0,T.jsx)(P.A,{variant:"contained",component:"span",children:"S\xe9lectionner des images"})}),(0,T.jsx)(l.A,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:1},children:i.map(((e,r)=>(0,T.jsx)(Be,{src:URL.createObjectURL(e),alt:`Nouvelle image ${r}`,onDelete:()=>a(r)},r)))})]})]})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:t,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:()=>d(s._id,i),variant:"contained",disabled:0===i.length,children:"Enregistrer les nouvelles images"})]})]}):null};const ar=function(){const e=(0,i.Zp)(),{paginatedProducts:r,categories:t,companies:s,availableSubcategories:n,formData:a,discountData:o,selectedImages:d,imagePreviews:c,loading:u,page:x,totalPages:h,openDialog:p,openDiscountDialog:j,openImageDialog:A,confirmDialog:g,confirmDiscountRemovalDialog:v,editMode:y,selectedProduct:f,handleOpenDialog:b,handleOpenDiscountDialog:C,handleOpenImageDialog:w,handleCloseDialog:S,handleCloseDiscountDialog:D,handleCloseImageDialog:R,handleInputChange:I,handleDiscountInputChange:k,handleImageChange:E,handleRemoveImage:q,handleRemoveServerImage:W,handleSubmit:N,handleSubmitDiscount:M,handleDeleteClick:$,handleConfirmDelete:F,handleRemoveDiscountClick:B,handleConfirmRemoveDiscount:z,handleChangePage:L,saveProductImages:V,setConfirmDialog:U,setConfirmDiscountRemovalDialog:O,setSelectedImages:K}=Qe();return u?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,T.jsx)(_.A,{})}):(0,T.jsxs)("div",{children:[(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,T.jsx)(m.A,{variant:"h4",children:"Gestion des Produits"}),(0,T.jsx)(P.A,{variant:"contained",startIcon:(0,T.jsx)(Ne.A,{}),onClick:()=>b(),children:"Ajouter un produit"})]}),(0,T.jsx)(be.Ay,{container:!0,spacing:3,children:r.length>0?r.map((r=>(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,T.jsx)(rr,{product:r,onEdit:()=>e(`/admin/products/edit/${r._id}`),onDelete:$,onManageImages:w,onManageDiscount:C,onRemoveDiscount:B})},r._id))):(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(me.A,{sx:{p:3,textAlign:"center"},children:(0,T.jsx)(m.A,{children:"Aucun produit trouv\xe9"})})})}),(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:3},children:(0,T.jsx)(He.A,{count:h,page:x,onChange:L,color:"primary",showFirstButton:!0,showLastButton:!0})}),(0,T.jsx)(sr,{open:p,onClose:S,formData:a,onChange:I,onSubmit:N,categories:t,companies:s,availableSubcategories:n,imagePreviews:c,onImageChange:E,onRemoveImage:q,editMode:y}),(0,T.jsx)(ir,{open:j,onClose:D,discountData:o,onChange:k,onSubmit:M}),(0,T.jsx)(nr,{open:A,onClose:R,product:f,selectedImages:d,onImageChange:E,onRemoveImage:e=>{const r=[...d];r.splice(e,1),K(r)},onRemoveServerImage:W,onSave:(e,r)=>{V(e,r).then((e=>{e.success&&R()}))}}),(0,T.jsx)(Fe,{open:g.open,title:"Confirmer la suppression",message:"\xcates-vous s\xfbr de vouloir supprimer ce produit? Cette action est irr\xe9versible.",onConfirm:F,onCancel:()=>U({open:!1,id:null})}),(0,T.jsx)(Fe,{open:v.open,title:"Confirmer la suppression",message:"\xcates-vous s\xfbr de vouloir supprimer cette remise?",onConfirm:z,onCancel:()=>O({open:!1,id:null})})]})};var or=t(14801),lr=t(72934),dr=t(63338),cr=t(52432),ur=t(36080),xr=t(9221);const hr=e=>{let{title:r,subtitle:t,breadcrumbs:s,action:i,children:n}=e;const o=(0,a.A)(),d=(0,c.A)(o.breakpoints.down("sm"));return(0,T.jsxs)(me.A,{elevation:0,sx:{p:3,mb:3,borderRadius:2,background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",border:"1px solid rgba(0,0,0,0.05)"},children:[s&&s.length>0&&(0,T.jsx)(cr.A,{separator:(0,T.jsx)(xr.A,{fontSize:"small"}),"aria-label":"breadcrumb",sx:{mb:2},children:s.map(((e,r)=>r===s.length-1?(0,T.jsx)(m.A,{color:"text.primary",fontWeight:500,children:e.label},r):(0,T.jsx)(ur.A,{component:ne.N_,to:e.path,underline:"hover",color:"inherit",children:e.label},r)))}),(0,T.jsxs)(l.A,{sx:{display:"flex",flexDirection:d?"column":"row",justifyContent:"space-between",alignItems:d?"flex-start":"center",mb:t?1:n?2:0},children:[(0,T.jsxs)(l.A,{children:[(0,T.jsx)(m.A,{variant:"h4",component:"h1",fontWeight:"bold",sx:{color:o.palette.text.primary,fontSize:{xs:"1.5rem",sm:"1.75rem",md:"2rem"}},children:r}),t&&(0,T.jsx)(m.A,{variant:"subtitle1",color:"text.secondary",sx:{mt:.5,mb:n?2:0},children:t})]}),i&&(0,T.jsx)(P.A,{variant:i.variant||"contained",color:i.color||"primary",startIcon:i.icon||null,onClick:i.onClick,size:i.size||"medium",sx:{mt:d?2:0,...i.sx},disabled:i.disabled||!1,children:i.label})]}),n]})};var mr=t(93125),pr=t(39919),jr=t(2507);const Ar=e=>{let{productId:r,productType:t,onProductTypeChange:i}=e;const[n,a]=(0,s.useState)(t||"simple"),[o,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(null),[x,h]=(0,s.useState)(!1),p=()=>{d(!1),u(null)};return(0,T.jsxs)(l.A,{sx:{mb:3},children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Type de produit"}),(0,T.jsxs)(mr.A,{value:n,exclusive:!0,onChange:(e,r)=>{r&&r!==n&&(u(r),d(!0))},"aria-label":"type de produit",sx:{mb:1},children:[(0,T.jsxs)(pr.A,{value:"simple","aria-label":"produit simple",children:[(0,T.jsx)(jr.A,{sx:{mr:1}}),"Simple"]}),(0,T.jsxs)(pr.A,{value:"variable","aria-label":"produit variable",children:[(0,T.jsx)(Z.A,{sx:{mr:1}}),"Variable"]})]}),(0,T.jsx)(m.A,{variant:"body2",color:"text.secondary",children:(e=>"simple"===e?"Un produit unique sans variations (couleur, taille, etc.)":"Un produit avec plusieurs variations (couleur, taille, etc.)")(n)}),(0,T.jsxs)(ke.A,{open:o,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,T.jsxs)(Ee.A,{id:"alert-dialog-title",children:["Convertir en ",(e=>"simple"===e?"Produit simple":"Produit variable")(c)]}),(0,T.jsx)(qe.A,{children:(0,T.jsx)($e.A,{id:"alert-dialog-description",children:"simple"===c?"Cette action va convertir le produit variable en produit simple. Toutes les variations seront fusionn\xe9es et le stock total sera conserv\xe9. Cette action est irr\xe9versible. \xcates-vous s\xfbr de vouloir continuer ?":"Cette action va convertir le produit simple en produit variable. Une variation par d\xe9faut sera cr\xe9\xe9e avec le stock actuel. Vous pourrez ensuite ajouter d'autres variations. Voulez-vous continuer ?"})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:p,disabled:x,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:async()=>{h(!0);try{if(!r)return void z.oR.error("ID du produit non d\xe9fini. Veuillez d'abord enregistrer le produit avant de le convertir.");const e=`/products/${r}/convert-to-${c}`,t=await dr.A.put(e);t.data&&t.data.product&&(a(c),i&&i(c,t.data.product),z.oR.success(`Produit converti en produit ${"simple"===c?"simple":"variable"} avec succ\xe8s.`))}catch(s){var e,t;console.error("Erreur lors de la conversion du produit:",s),z.oR.error(`Erreur lors de la conversion du produit: ${(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message}`)}finally{h(!1),d(!1)}},autoFocus:!0,color:"primary",disabled:x,children:x?"Conversion en cours...":"Convertir"})]})]})]})};var gr=t(27222);const vr=e=>{if(["white","ivory","lightyellow","yellow","lightgreen","lightblue","lavender","pink"].includes(e))return!0;if(e.startsWith("#")){const r=e.substring(1),t=parseInt(r,16);return(.299*(t>>16&255)+.587*(t>>8&255)+.114*(255&t))/255>.5}return!1},yr=e=>{let{productId:r,onVariationsChange:t,existingVariations:i=[],availableAttributes:n={colors:[],sizes:[]}}=e;const[a,o]=(0,s.useState)(i||[]),[d,c]=(0,s.useState)(!1),[u,x]=(0,s.useState)(null),[p,j]=(0,s.useState)(!1),[A,y]=(0,s.useState)(""),[f,b]=(0,s.useState)(""),[C,w]=(0,s.useState)(0),[S,_]=(0,s.useState)(""),[D,R]=(0,s.useState)(""),[I,k]=(0,s.useState)(n.colors||[]),[E,q]=(0,s.useState)(n.sizes||[]),[W,N]=(0,s.useState)(""),[$,F]=(0,s.useState)(""),[B,L]=(0,s.useState)([]),[V,U]=(0,s.useState)(null);(0,s.useEffect)((()=>{o(i||[])}),[i]),(0,s.useEffect)((()=>{k(n.colors||[]),q(n.sizes||[])}),[n]);const O=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var r,t;e?(j(!0),x(e),y((null===(r=e.attributes)||void 0===r?void 0:r.color)||""),b((null===(t=e.attributes)||void 0===t?void 0:t.size)||""),w(e.quantite||0),_(e.price||""),R(e.sku||""),L([]),U(e.mainPicture||null)):(j(!1),x(null),y(""),b(""),w(0),_(""),R(H()),L([]),U(null));c(!0)},K=()=>{c(!1),G()},G=()=>{y(""),b(""),w(0),_(""),R(""),L([]),U(null)},H=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let r="";for(let t=0;t<8;t++)r+=e.charAt(Math.floor(36*Math.random()));return r},Q=e=>{const r=Array.from(e.target.files);if(L(r),r.length>0){const e=new FileReader;e.onload=()=>{U(e.result)},e.readAsDataURL(r[0])}},Z=e=>e?`${e.toLocaleString()} MRU`:"\u2014";return(0,T.jsxs)(l.A,{sx:{mt:3},children:[(0,T.jsx)(Ze.A,{children:(0,T.jsxs)(Je.A,{children:[(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,T.jsx)(m.A,{variant:"h6",component:"h2",children:"Variations du produit"}),(0,T.jsx)(P.A,{variant:"contained",color:"primary",startIcon:(0,T.jsx)(Ne.A,{}),onClick:()=>O(),children:"Ajouter une variation"})]}),(0,T.jsxs)(l.A,{sx:{mb:3},children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Attributs disponibles"}),(0,T.jsxs)(be.Ay,{container:!0,spacing:2,children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,md:6,children:[(0,T.jsx)(m.A,{variant:"body2",gutterBottom:!0,children:(0,T.jsx)("strong",{children:"Couleurs:"})}),(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:I.length>0?I.map((e=>(0,T.jsx)(Le.A,{label:e,size:"small",style:{backgroundColor:e.toLowerCase(),color:vr(e.toLowerCase())?"#000":"#fff",margin:"2px"}},e))):(0,T.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"Aucune couleur d\xe9finie. Ajoutez des couleurs en cr\xe9ant des variations."})})]}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,md:6,children:[(0,T.jsx)(m.A,{variant:"body2",gutterBottom:!0,children:(0,T.jsx)("strong",{children:"Tailles:"})}),(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:E.length>0?E.map((e=>(0,T.jsx)(Le.A,{label:e,size:"small",style:{margin:"2px"}},e))):(0,T.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"Aucune taille d\xe9finie. Ajoutez des tailles en cr\xe9ant des variations."})})]})]})]}),0===a.length?(0,T.jsx)(pe.A,{severity:"info",children:"Ce produit n'a pas encore de variations. Ajoutez-en une pour commencer."}):(0,T.jsx)(Se.A,{component:me.A,children:(0,T.jsxs)(Pe.A,{children:[(0,T.jsx)(_e.A,{children:(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:"Image"}),(0,T.jsx)(Re.A,{children:"Couleur"}),(0,T.jsx)(Re.A,{children:"Taille"}),(0,T.jsx)(Re.A,{children:"SKU"}),(0,T.jsx)(Re.A,{align:"right",children:"Prix"}),(0,T.jsx)(Re.A,{align:"right",children:"Quantit\xe9"}),(0,T.jsx)(Re.A,{align:"right",children:"Actions"})]})}),(0,T.jsx)(Ie.A,{children:a.map((e=>{var s,i;return(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:e.mainPicture?(0,T.jsx)(l.A,{component:"img",src:e.mainPicture,alt:`Variation ${e._id}`,sx:{width:50,height:50,objectFit:"cover"}}):(0,T.jsx)(l.A,{sx:{width:50,height:50,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,T.jsx)(gr.A,{color:"disabled"})})}),(0,T.jsx)(Re.A,{children:null!==(s=e.attributes)&&void 0!==s&&s.color?(0,T.jsx)(Le.A,{label:e.attributes.color,size:"small",style:{backgroundColor:e.attributes.color.toLowerCase(),color:vr(e.attributes.color.toLowerCase())?"#000":"#fff"}}):"\u2014"}),(0,T.jsx)(Re.A,{children:(null===(i=e.attributes)||void 0===i?void 0:i.size)||"\u2014"}),(0,T.jsx)(Re.A,{children:e.sku}),(0,T.jsx)(Re.A,{align:"right",children:e.price?Z(e.price):"\u2014"}),(0,T.jsx)(Re.A,{align:"right",children:e.quantite}),(0,T.jsxs)(Re.A,{align:"right",children:[(0,T.jsx)(h.A,{color:"primary",onClick:()=>O(e),size:"small",children:(0,T.jsx)(Me.A,{})}),(0,T.jsx)(h.A,{color:"error",onClick:()=>(async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cette variation ?"))try{const s=await dr.A.delete(`/products/${r}/variations/${e}`);s.data&&s.data.product&&(t&&t(s.data.product.variations),o(s.data.product.variations),z.oR.success("Variation supprim\xe9e avec succ\xe8s."))}catch(s){console.error("Erreur lors de la suppression de la variation:",s),z.oR.error("Erreur lors de la suppression de la variation.")}})(e._id),size:"small",children:(0,T.jsx)(M.A,{})})]})]},e._id)}))})]})})]})}),(0,T.jsxs)(ke.A,{open:d,onClose:K,maxWidth:"md",fullWidth:!0,children:[(0,T.jsx)(Ee.A,{children:p?"Modifier la variation":"Ajouter une variation"}),(0,T.jsx)(qe.A,{children:(0,T.jsxs)(be.Ay,{container:!0,spacing:3,sx:{mt:1},children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,md:6,children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Attributs de la variation"}),(0,T.jsxs)(be.Ay,{container:!0,spacing:2,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,margin:"normal",children:[(0,T.jsx)(Ue.A,{id:"color-label",children:"Couleur"}),(0,T.jsxs)(Oe.A,{labelId:"color-label",value:A,onChange:e=>y(e.target.value),label:"Couleur",children:[(0,T.jsx)(v.A,{value:"",children:(0,T.jsx)("em",{children:"Aucune"})}),I.map((e=>(0,T.jsx)(v.A,{value:e,children:(0,T.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,T.jsx)(l.A,{sx:{width:16,height:16,marginRight:1,backgroundColor:e.toLowerCase(),border:"1px solid #ddd"}}),e]})},e)))]})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,T.jsx)(je.A,{label:"Nouvelle couleur",value:W,onChange:e=>N(e.target.value),size:"small",sx:{flexGrow:1,mr:1}}),(0,T.jsx)(P.A,{variant:"outlined",onClick:()=>{W&&!I.includes(W)&&(k((e=>[...e,W])),N(""))},size:"small",children:"Ajouter"})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,margin:"normal",children:[(0,T.jsx)(Ue.A,{id:"size-label",children:"Taille"}),(0,T.jsxs)(Oe.A,{labelId:"size-label",value:f,onChange:e=>b(e.target.value),label:"Taille",children:[(0,T.jsx)(v.A,{value:"",children:(0,T.jsx)("em",{children:"Aucune"})}),E.map((e=>(0,T.jsx)(v.A,{value:e,children:e},e)))]})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,T.jsx)(je.A,{label:"Nouvelle taille",value:$,onChange:e=>F(e.target.value),size:"small",sx:{flexGrow:1,mr:1}}),(0,T.jsx)(P.A,{variant:"outlined",onClick:()=>{$&&!E.includes($)&&(q((e=>[...e,$])),F(""))},size:"small",children:"Ajouter"})]})})]}),(0,T.jsx)(g.A,{sx:{my:2}}),(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Informations de stock"}),(0,T.jsxs)(be.Ay,{container:!0,spacing:2,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{label:"Quantit\xe9 en stock",value:C,onChange:e=>w(parseInt(e.target.value)||0),type:"number",fullWidth:!0,margin:"normal",InputProps:{inputProps:{min:0}}})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{label:"Prix sp\xe9cifique (optionnel)",value:S,onChange:e=>_(e.target.value),type:"number",fullWidth:!0,margin:"normal",helperText:"Laissez vide pour utiliser le prix du produit",InputProps:{inputProps:{min:0}}})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{label:"SKU",value:D,onChange:e=>R(e.target.value),fullWidth:!0,margin:"normal"})})]})]}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,md:6,children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Images de la variation"}),(0,T.jsx)(l.A,{sx:{border:"2px dashed #ccc",borderRadius:1,p:2,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:200,mb:2},children:V?(0,T.jsxs)(l.A,{sx:{textAlign:"center"},children:[(0,T.jsx)(l.A,{component:"img",src:V,alt:"Aper\xe7u",sx:{maxWidth:"100%",maxHeight:200,mb:2}}),(0,T.jsxs)(P.A,{variant:"outlined",component:"label",sx:{mt:1},children:["Changer l'image",(0,T.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:Q,multiple:!0})]})]}):(0,T.jsxs)(P.A,{variant:"outlined",component:"label",children:["Ajouter des images",(0,T.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:Q,multiple:!0})]})}),(0,T.jsx)(m.A,{variant:"body2",color:"textSecondary",children:B.length>0?`${B.length} fichier(s) s\xe9lectionn\xe9(s)`:"Aucun fichier s\xe9lectionn\xe9"}),B.length>0&&(0,T.jsxs)(l.A,{sx:{mt:2},children:[(0,T.jsx)(m.A,{variant:"body2",gutterBottom:!0,children:"Fichiers \xe0 t\xe9l\xe9charger :"}),(0,T.jsx)("ul",{children:B.map(((e,r)=>(0,T.jsx)("li",{children:e.name},r)))})]})]})]})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:K,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:async()=>{if(A||f)if(C<0)z.oR.error("La quantit\xe9 ne peut pas \xeatre n\xe9gative.");else try{const e=new FormData;let s;e.append("color",A),e.append("size",f),e.append("quantite",C),S&&e.append("price",S),e.append("sku",D),B.length>0&&B.forEach((r=>{e.append("pictures",r)})),s=p&&u?await dr.A.put(`/products/${r}/variations/${u._id}`,e):await dr.A.post(`/products/${r}/variations`,e),s.data&&s.data.product&&(t&&t(s.data.product.variations),o(s.data.product.variations),z.oR.success(p?"Variation mise \xe0 jour avec succ\xe8s.":"Variation ajout\xe9e avec succ\xe8s."),K())}catch(e){console.error("Erreur lors de l'enregistrement de la variation:",e),z.oR.error("Erreur lors de l'enregistrement de la variation.")}else z.oR.error("Veuillez sp\xe9cifier au moins une couleur ou une taille.")},variant:"contained",color:"primary",children:p?"Mettre \xe0 jour":"Ajouter"})]})]})]})},fr=()=>{const{id:e}=(0,i.g)(),r=(0,i.Zp)(),t=!e||"new"===e||"undefined"===e,[n,a]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(null),[x,h]=(0,s.useState)([]),[p,j]=(0,s.useState)([]),[A,y]=(0,s.useState)([]),[f,b]=(0,s.useState)([]),[C,w]=(0,s.useState)({nom:"",description:"",features:"",oldPrice:"",quantite:"0",Company_id:"",categoriesa_id:[],subcategories_id:[],productType:"simple"}),[S,D]=(0,s.useState)([]),[R,I]=(0,s.useState)([]);(0,s.useEffect)((()=>{(async()=>{try{a(!0);const[o,l,d]=await Promise.all([dr.A.get("/categories"),dr.A.get("/subcategories"),dr.A.get("/companies")]);if(h(o.data),j(l.data),y(d.data),!t&&e&&"undefined"!==e)try{const r=await dr.A.get(`/products/${e}`);u(r.data);const t=r.data,s=t.categoriesa_id.map((e=>"object"===typeof e?e._id:e)),i=t.subcategories_id.map((e=>"object"===typeof e?e._id:e));w({nom:t.nom,description:t.description||"",features:t.features||"",oldPrice:t.oldPrice.toString(),quantite:void 0!==t.quantite&&null!==t.quantite?t.quantite.toString():"0",Company_id:t.Company_id._id||t.Company_id,categoriesa_id:s,subcategories_id:i,productType:t.productType||"simple"}),I(t.pictures||[])}catch(n){var s,i;console.error("Erreur lors du chargement du produit:",n),z.oR.error(`Impossible de charger le produit: ${(null===(s=n.response)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.message)||n.message}`),r("/admin/products")}}catch(o){console.error("Erreur lors du chargement des donn\xe9es:",o),z.oR.error("Erreur lors du chargement des donn\xe9es")}finally{a(!1)}})()}),[e,t,r]),(0,s.useEffect)((()=>{if(C.categoriesa_id&&C.categoriesa_id.length>0){const e=p.filter((e=>{var r;const t=(null===(r=e.categories_id)||void 0===r?void 0:r._id)||e.categories_id;return t&&C.categoriesa_id.includes(t)}));b(e);const r=C.subcategories_id.filter((r=>e.some((e=>e._id===r))));r.length!==C.subcategories_id.length&&w((e=>({...e,subcategories_id:r})))}else b([]),C.subcategories_id.length>0&&w((e=>({...e,subcategories_id:[]})))}),[C.categoriesa_id,p]);const k=e=>{const{name:r,value:t}=e.target;w((e=>({...e,[r]:t})))};return n?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,T.jsx)(_.A,{})}):(0,T.jsxs)(l.A,{children:[(0,T.jsx)(hr,{title:t?"Nouveau produit":"Modifier le produit",subtitle:t?"Ajouter un nouveau produit":`\xc9dition du produit: ${C.nom}`,action:(0,T.jsx)(P.A,{startIcon:(0,T.jsx)(or.A,{}),variant:"outlined",onClick:()=>r("/admin/products"),children:"Retour"})}),(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(Ze.A,{children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Informations g\xe9n\xe9rales"}),(0,T.jsxs)(be.Ay,{container:!0,spacing:2,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{name:"nom",label:"Nom du produit *",fullWidth:!0,value:C.nom,onChange:k,required:!0,margin:"normal"})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,margin:"normal",children:[(0,T.jsx)(Ue.A,{id:"company-label",children:"Entreprise *"}),(0,T.jsx)(Oe.A,{labelId:"company-label",name:"Company_id",value:C.Company_id,onChange:k,required:!0,children:A.map((e=>(0,T.jsx)(v.A,{value:e._id,children:e.nom},e._id)))})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{name:"oldPrice",label:"Prix (MRU) *",fullWidth:!0,type:"number",InputProps:{startAdornment:(0,T.jsx)(tr.A,{position:"start",children:"MRU"})},value:C.oldPrice,onChange:k,required:!0,margin:"normal"})}),"simple"===C.productType&&(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{name:"quantite",label:"Quantit\xe9 en stock *",fullWidth:!0,type:"number",value:C.quantite,onChange:k,required:!0,margin:"normal",InputProps:{inputProps:{min:0}}})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"description",label:"Description",fullWidth:!0,multiline:!0,rows:3,value:C.description,onChange:k,margin:"normal"})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"features",label:"Caract\xe9ristiques",fullWidth:!0,multiline:!0,rows:2,value:C.features,onChange:k,margin:"normal"})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,margin:"normal",children:[(0,T.jsx)(Ue.A,{id:"categories-label",children:"Cat\xe9gories *"}),(0,T.jsx)(Oe.A,{labelId:"categories-label",multiple:!0,name:"categoriesa_id",value:C.categoriesa_id,onChange:k,input:(0,T.jsx)(Ke.A,{label:"Cat\xe9gories"}),renderValue:e=>(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e=>{const r=x.find((r=>r._id===e));return r?(0,T.jsx)(Le.A,{label:r.name},e):null}))}),children:x.map((e=>(0,T.jsx)(v.A,{value:e._id,children:e.name},e._id)))})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,margin:"normal",children:[(0,T.jsx)(Ue.A,{id:"subcategories-label",children:"Sous-cat\xe9gories"}),(0,T.jsx)(Oe.A,{labelId:"subcategories-label",multiple:!0,name:"subcategories_id",value:C.subcategories_id,onChange:k,input:(0,T.jsx)(Ke.A,{label:"Sous-cat\xe9gories"}),renderValue:e=>(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((e=>{const r=p.find((r=>r._id===e));return r?(0,T.jsx)(Le.A,{label:r.name},e):null}))}),disabled:0===C.categoriesa_id.length,children:f.map((e=>(0,T.jsx)(v.A,{value:e._id,children:e.name},e._id)))})]})})]})]})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(Ze.A,{children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Images du produit"}),(0,T.jsxs)(l.A,{sx:{my:2},children:[(0,T.jsx)("input",{accept:"image/*",style:{display:"none"},id:"images-upload",type:"file",multiple:!0,onChange:e=>{if(e.target.files){const r=Array.from(e.target.files);D([...S,...r]);const t=r.map((e=>URL.createObjectURL(e)));I([...R,...t])}}}),(0,T.jsx)("label",{htmlFor:"images-upload",children:(0,T.jsx)(P.A,{variant:"outlined",component:"span",children:"Ajouter des images"})})]}),R.length>0?(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:R.map(((e,r)=>(0,T.jsxs)(l.A,{sx:{position:"relative",width:150,height:150,border:"1px solid #ddd",borderRadius:1,overflow:"hidden",mb:2},children:[(0,T.jsx)("img",{src:e,alt:`Image ${r}`,style:{width:"100%",height:"100%",objectFit:"cover"}}),c&&e===c.mainPicture&&(0,T.jsx)(l.A,{sx:{position:"absolute",bottom:0,left:0,right:0,bgcolor:"primary.main",color:"white",textAlign:"center",py:.5},children:(0,T.jsx)(m.A,{variant:"caption",children:"Principale"})})]},r)))}):(0,T.jsx)(pe.A,{severity:"info",children:"Aucune image n'a \xe9t\xe9 ajout\xe9e. Ajoutez au moins une image pour le produit."})]})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(Ze.A,{children:(0,T.jsxs)(Je.A,{children:[t?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Type de produit"}),(0,T.jsxs)(l.A,{sx:{mb:2},children:[(0,T.jsxs)(Ve.A,{fullWidth:!0,children:[(0,T.jsx)(Ue.A,{id:"product-type-label",children:"Type de produit"}),(0,T.jsxs)(Oe.A,{labelId:"product-type-label",name:"productType",value:C.productType,onChange:e=>w((r=>({...r,productType:e.target.value}))),children:[(0,T.jsx)(v.A,{value:"simple",children:"Produit simple"}),(0,T.jsx)(v.A,{value:"variable",children:"Produit variable (avec couleurs, tailles, etc.)"})]})]}),(0,T.jsx)(m.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"simple"===C.productType?"Un produit simple est un produit unique avec un seul prix et une seule quantit\xe9 en stock.":"Un produit variable vous permet de d\xe9finir des variations (couleurs, tailles, etc.) avec des stocks et prix sp\xe9cifiques."})]})]}):(0,T.jsx)(Ar,{productId:e,productType:C.productType,onProductTypeChange:(e,r)=>{w((r=>({...r,productType:e}))),r&&(u(r),"simple"===e&&r.quantite&&w((e=>({...e,quantite:r.quantite.toString()}))))}}),(0,T.jsx)(g.A,{sx:{my:3}}),"variable"===C.productType&&!t&&(0,T.jsx)(yr,{productId:e,existingVariations:(null===c||void 0===c?void 0:c.variations)||[],availableAttributes:(null===c||void 0===c?void 0:c.availableAttributes)||{colors:[],sizes:[]},onVariationsChange:e=>{c&&u((r=>({...r,variations:e})))}}),"variable"===C.productType&&t&&(0,T.jsxs)(l.A,{children:[(0,T.jsx)(pe.A,{severity:"info",sx:{mb:2},children:"Vous avez choisi de cr\xe9er un produit variable. Les options de variations seront disponibles apr\xe8s l'enregistrement du produit."}),(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Comment fonctionnent les produits variables ?"}),(0,T.jsx)(m.A,{variant:"body2",paragraph:!0,children:"Un produit variable permet de g\xe9rer plusieurs versions d'un m\xeame produit avec des attributs diff\xe9rents comme :"}),(0,T.jsxs)(l.A,{component:"ul",sx:{pl:2},children:[(0,T.jsx)(m.A,{component:"li",variant:"body2",children:"Des couleurs diff\xe9rentes (rouge, bleu, vert, etc.)"}),(0,T.jsx)(m.A,{component:"li",variant:"body2",children:"Des tailles diff\xe9rentes (S, M, L, XL, etc.)"}),(0,T.jsx)(m.A,{component:"li",variant:"body2",children:"Des quantit\xe9s en stock sp\xe9cifiques \xe0 chaque variation"}),(0,T.jsx)(m.A,{component:"li",variant:"body2",children:"Des prix sp\xe9cifiques (optionnel) pour certaines variations"})]}),(0,T.jsx)(m.A,{variant:"body2",paragraph:!0,sx:{mt:2},children:"Apr\xe8s avoir enregistr\xe9 ce produit, vous pourrez :"}),(0,T.jsxs)(l.A,{component:"ol",sx:{pl:2},children:[(0,T.jsx)(m.A,{component:"li",variant:"body2",children:"Ajouter des attributs disponibles (couleurs, tailles)"}),(0,T.jsx)(m.A,{component:"li",variant:"body2",children:"Cr\xe9er des variations sp\xe9cifiques avec ces attributs"}),(0,T.jsx)(m.A,{component:"li",variant:"body2",children:"D\xe9finir le stock pour chaque variation"})]})]})]})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(me.A,{sx:{p:2,display:"flex",justifyContent:"flex-end"},children:[(0,T.jsx)(P.A,{startIcon:(0,T.jsx)(or.A,{}),sx:{mr:2},onClick:()=>r("/admin/products"),children:"Annuler"}),(0,T.jsx)(P.A,{variant:"contained",startIcon:(0,T.jsx)(lr.A,{}),onClick:async()=>{if(C.nom&&C.oldPrice&&C.Company_id&&0!==C.categoriesa_id.length)try{var s,i;d(!0);const n=new FormData;let a;n.append("nom",C.nom),n.append("description",C.description),n.append("features",C.features),n.append("oldPrice",C.oldPrice),n.append("productType",C.productType),"simple"===C.productType&&n.append("quantite",C.quantite),n.append("Company_id",C.Company_id),C.categoriesa_id.forEach((e=>{n.append("categoriesa_id",e)})),C.subcategories_id.forEach((e=>{n.append("subcategories_id",e)})),S.forEach((e=>{n.append("pictures",e)})),t?(a=await dr.A.post("/products",n),z.oR.success("Produit cr\xe9\xe9 avec succ\xe8s")):(a=await dr.A.put(`/products/${e}`,n),z.oR.success("Produit mis \xe0 jour avec succ\xe8s")),t&&null!==(s=a.data)&&void 0!==s&&null!==(i=s.product)&&void 0!==i&&i._id?r(`/admin/products/edit/${a.data.product._id}`):r("/admin/products")}catch(n){console.error("Erreur lors de l'enregistrement du produit:",n),z.oR.error("Erreur lors de l'enregistrement du produit")}finally{d(!1)}else z.oR.error("Veuillez remplir tous les champs obligatoires")},disabled:o||!C.nom||!C.oldPrice||!C.Company_id||0===C.categoriesa_id.length||"simple"===C.productType&&!C.quantite,children:o?"Enregistrement...":"Enregistrer"})]})})]})]})};var br=t(72236),Cr=t(84142),wr=t(38517),Sr=t(40196),Pr=t(3937),_r=t(49715),Dr=t(8321),Rr=t(29240),Ir=t(23935),kr=t(31902),Er=t(68179),qr=t(37749),Wr=t(81831),Nr=t(82813),Mr=t(59113),$r=t(55271),Fr=t(81095),Br=t(80294),zr=t(93245),Tr=t(60158),Lr=t(44813),Vr=t(16335),Ur=t(25102),Or=t(85706),Kr=t(67360),Gr=t(54203),Hr=t(72528),Qr=t(2847),Zr=t(56473),Yr=t(58535),Jr=t(43754),Xr=t(37885);const et=e=>{var r;let{order:t}=e;if(!t)return null;const s=["en attente","confirm\xe9e","en pr\xe9paration","exp\xe9di\xe9e","livr\xe9e","pay\xe9e"],i=e=>{try{return new Date(e).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(r){return"Date invalide"}};return(0,T.jsxs)(l.A,{children:[(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,md:6,children:[(0,T.jsxs)(m.A,{variant:"h6",gutterBottom:!0,children:["Commande #",t.orderNumber]}),(0,T.jsxs)(m.A,{variant:"body2",color:"text.secondary",children:["Cr\xe9\xe9e le ",i(t.createdAt)]})]}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,md:6,sx:{textAlign:"right"},children:[(0,T.jsx)(Le.A,{label:t.status,color:"annul\xe9e"===t.status?"error":"livr\xe9e"===t.status||"pay\xe9e"===t.status?"success":"exp\xe9di\xe9e"===t.status?"primary":"en pr\xe9paration"===t.status?"secondary":"warning",sx:{mb:1}}),(0,T.jsxs)(m.A,{variant:"body2",children:["Paiement: ",t.isPaid?"Pay\xe9":"En attente de paiement",t.paymentDate&&` (${i(t.paymentDate)})`]})]})]}),"annul\xe9e"!==t.status?(0,T.jsx)(l.A,{sx:{mb:4,mt:3},children:(0,T.jsx)(Yr.A,{activeStep:"annul\xe9e"===t.status?-1:s.indexOf(t.status),alternativeLabel:!0,children:s.map((e=>(0,T.jsx)(Jr.A,{children:(0,T.jsx)(Xr.A,{children:e.charAt(0).toUpperCase()+e.slice(1)})},e)))})}):(0,T.jsx)(l.A,{sx:{mb:4,mt:3,bgcolor:"#ffebee",p:2,borderRadius:1},children:(0,T.jsx)(m.A,{color:"error",align:"center",children:"Cette commande a \xe9t\xe9 annul\xe9e"})}),(0,T.jsx)(g.A,{sx:{my:3}}),(0,T.jsxs)(be.Ay,{container:!0,spacing:4,children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,md:6,children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Informations client"}),(0,T.jsxs)(me.A,{variant:"outlined",sx:{p:2},children:[(0,T.jsxs)(m.A,{children:[t.customer.firstName," ",t.customer.lastName]}),(0,T.jsxs)(m.A,{variant:"body2",children:["T\xe9l\xe9phone: ",t.customer.phone]})]})]}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,md:6,children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Adresse de livraison"}),(0,T.jsxs)(me.A,{variant:"outlined",sx:{p:2},children:[(0,T.jsx)(m.A,{variant:"body1",children:t.shippingAddress.address}),(0,T.jsxs)(m.A,{variant:"body1",children:[t.shippingAddress.postalCode," ",t.shippingAddress.city]}),(0,T.jsx)(m.A,{variant:"body1",children:t.shippingAddress.country}),t.shippingAddress.additionalInfo&&(0,T.jsxs)(m.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Informations compl\xe9mentaires: ",t.shippingAddress.additionalInfo]})]})]})]}),(0,T.jsx)(g.A,{sx:{my:3}}),(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Produits command\xe9s"}),(0,T.jsx)(Se.A,{component:me.A,variant:"outlined",children:(0,T.jsxs)(Pe.A,{children:[(0,T.jsx)(_e.A,{children:(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:"Produit"}),(0,T.jsx)(Re.A,{align:"center",children:"Prix unitaire"}),(0,T.jsx)(Re.A,{align:"center",children:"Quantit\xe9"}),(0,T.jsx)(Re.A,{align:"right",children:"Total"})]})}),(0,T.jsxs)(Ie.A,{children:[t.items.map(((e,r)=>(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:(0,T.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[e.product&&e.product.mainPicture&&(0,T.jsx)(j.A,{src:e.product.mainPicture,alt:e.productName,variant:"rounded",sx:{width:40,height:40,mr:2}}),(0,T.jsxs)(l.A,{children:[(0,T.jsx)(m.A,{variant:"body2",children:e.productName}),e.product&&e.product.Company_id&&(0,T.jsx)(m.A,{variant:"caption",color:"text.secondary",children:"object"===typeof e.product.Company_id?e.product.Company_id.nom:"Marque"})]})]})}),(0,T.jsxs)(Re.A,{align:"center",children:[e.price.toFixed(2)," \u20ac"]}),(0,T.jsx)(Re.A,{align:"center",children:e.quantity}),(0,T.jsxs)(Re.A,{align:"right",children:[e.totalPrice.toFixed(2)," \u20ac"]})]},r))),(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{colSpan:3,align:"right",sx:{fontWeight:"bold"},children:"Total"}),(0,T.jsxs)(Re.A,{align:"right",sx:{fontWeight:"bold"},children:[t.totalAmount.toFixed(2)," \u20ac"]})]})]})]})}),(0,T.jsx)(g.A,{sx:{my:3}}),(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Historique"}),(0,T.jsx)(me.A,{variant:"outlined",sx:{p:0},children:(0,T.jsx)(D.A,{sx:{width:"100%"},children:null===(r=t.statusHistory)||void 0===r?void 0:r.map(((e,r)=>(0,T.jsx)(R.Ay,{divider:r<t.statusHistory.length-1,children:(0,T.jsx)(f.A,{primary:(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,T.jsxs)(m.A,{variant:"body2",sx:{fontWeight:"medium"},children:["Statut: ",(0,T.jsx)(Le.A,{size:"small",label:e.status,sx:{ml:1}})]}),(0,T.jsx)(m.A,{variant:"body2",color:"text.secondary",children:i(e.date)})]}),secondary:e.comment&&`Commentaire: ${e.comment}`})},r)))})}),t.notes&&(0,T.jsxs)(l.A,{sx:{mt:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Notes"}),(0,T.jsx)(me.A,{variant:"outlined",sx:{p:2},children:(0,T.jsx)(m.A,{variant:"body2",children:t.notes})})]})]})},rt=e=>{let{open:r,onClose:t,onUpdateStatus:i,order:n,statuses:a}=e;const[o,d]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[x,h]=(0,s.useState)("");s.useEffect((()=>{r&&n&&(d(n.status),u(""),h(""))}),[r,n]);return n?(0,T.jsxs)(ke.A,{open:r,onClose:t,fullWidth:!0,maxWidth:"sm",children:[(0,T.jsx)(Ee.A,{children:"Mettre \xe0 jour le statut de la commande"}),(0,T.jsxs)(qe.A,{dividers:!0,children:[(0,T.jsxs)(m.A,{variant:"subtitle1",gutterBottom:!0,children:["Commande #",n.orderNumber]}),(0,T.jsxs)(m.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Client: ",n.customer.firstName," ",n.customer.lastName]}),(0,T.jsx)(g.A,{sx:{my:2}}),x&&(0,T.jsx)(pe.A,{severity:"error",sx:{mb:2},children:x}),(0,T.jsxs)(Ve.A,{fullWidth:!0,sx:{mb:3},children:[(0,T.jsx)(Ue.A,{children:"Statut"}),(0,T.jsx)(Oe.A,{value:o,onChange:e=>d(e.target.value),label:"Statut",children:a.map((e=>(0,T.jsx)(v.A,{value:e.value,children:e.label},e.value)))})]}),(0,T.jsx)(je.A,{fullWidth:!0,label:"Commentaire (optionnel)",multiline:!0,rows:3,value:c,onChange:e=>u(e.target.value),placeholder:"Ajoutez un commentaire sur la mise \xe0 jour du statut..."}),(0,T.jsx)(l.A,{sx:{mt:3,p:2,bgcolor:"#f5f5f5",borderRadius:1},children:(0,T.jsxs)(m.A,{variant:"body2",children:[(0,T.jsx)("strong",{children:"Note:"}),' Si vous d\xe9finissez le statut sur "pay\xe9e", la commande sera automatiquement marqu\xe9e comme pay\xe9e avec la date actuelle.']})})]}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:t,children:"Annuler"}),(0,T.jsx)(P.A,{variant:"contained",color:"primary",onClick:()=>{o?i(o,c):h("Veuillez s\xe9lectionner un statut")},children:"Mettre \xe0 jour"})]})]}):null},tt=["#0088FE","#00C49F","#FFBB28","#FF8042","#A52A2A","#7B68EE","#FF6347","#20B2AA"],st=()=>{const e=(0,a.A)(),[r,t]=(0,s.useState)(0),[i,n]=(0,s.useState)([]),[o,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(!0),[x,j]=(0,s.useState)(""),[A,g]=(0,s.useState)(""),[y,f]=(0,s.useState)(""),[b,C]=(0,s.useState)({startDate:null,endDate:null}),[w,S]=(0,s.useState)(!1),[D,R]=(0,s.useState)("3months"),[I,k]=(0,s.useState)(0),[E,q]=(0,s.useState)(null),[W,N]=(0,s.useState)(!1),[M,L]=(0,s.useState)(!1),[V,U]=(0,s.useState)(null),[K,G]=(0,s.useState)({totalOrders:0,totalRevenue:0,ordersByStatus:[],ordersByDay:[]}),H=[{value:"en attente",label:"En attente",color:"warning"},{value:"confirm\xe9e",label:"Confirm\xe9e",color:"info"},{value:"en pr\xe9paration",label:"En pr\xe9paration",color:"secondary"},{value:"exp\xe9di\xe9e",label:"Exp\xe9di\xe9e",color:"primary"},{value:"livr\xe9e",label:"Livr\xe9e",color:"success"},{value:"pay\xe9e",label:"Pay\xe9e",color:"success"},{value:"annul\xe9e",label:"Annul\xe9e",color:"error"}],Q=async()=>{try{const e=b.startDate&&b.endDate?i.filter((e=>{const r=new Date(e.createdAt);return r>=b.startDate&&r<=b.endDate})):i,r={totalOrders:e.length,totalRevenue:e.reduce(((e,r)=>e+r.totalAmount),0),ordersByStatus:Object.entries(e.reduce(((e,r)=>(e[r.status]=(e[r.status]||0)+1,e)),{})).map((r=>{let[t,s]=r;return{_id:t,count:s,total:e.filter((e=>e.status===t)).reduce(((e,r)=>e+r.totalAmount),0)}})),ordersByDay:Object.entries(e.reduce(((e,r)=>{const t=new Date(r.createdAt).toLocaleDateString("fr-FR");return e[t]=(e[t]||0)+1,e}),{})).map((e=>{let[r,t]=e;return{name:r,count:t}}))};G(r)}catch(x){console.error("Erreur lors du calcul des statistiques:",x)}},Z=()=>{const e=i.reduce(((e,r)=>(e[r.status]=(e[r.status]||0)+1,e)),{});return Object.entries(e).map((e=>{let[r,t]=e;return{name:r,count:t}})).sort(((e,r)=>r.count-e.count))},Y=()=>[{name:"< 50\u20ac",value:i.filter((e=>e.totalAmount<50)).length},{name:"50-100\u20ac",value:i.filter((e=>e.totalAmount>=50&&e.totalAmount<100)).length},{name:"100-200\u20ac",value:i.filter((e=>e.totalAmount>=100&&e.totalAmount<200)).length},{name:"200-500\u20ac",value:i.filter((e=>e.totalAmount>=200&&e.totalAmount<500)).length},{name:"> 500\u20ac",value:i.filter((e=>e.totalAmount>=500)).length}],J=()=>{const e=new Date;let r,t=[];switch(D){case"3months":default:r=3;break;case"6months":r=6;break;case"12months":r=12}for(let s=0;s<r;s++){const r=(0,Mr.A)(e,s),n=(0,$.A)(r,"MMMM yyyy",{locale:F.A}),a=i.filter((e=>{const t=new Date(e.createdAt);return t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear()})),o={name:n,totalOrders:a.length,totalRevenue:a.reduce(((e,r)=>e+r.totalAmount),0),averageOrderValue:a.length>0?a.reduce(((e,r)=>e+r.totalAmount),0)/a.length:0};t.push(o)}return t.reverse()},X=()=>{const e=$r.Wp.book_new(),r=i.map((e=>({"N\xb0 de commande":e.orderNumber,Date:(0,$.A)(new Date(e.createdAt),"dd/MM/yyyy"),Client:`${e.customer.firstName} ${e.customer.lastName}`,Email:e.customer.email,"T\xe9l\xe9phone":e.customer.phone,"Montant total":e.totalAmount,Statut:e.status,"Pay\xe9e":e.isPaid?"Oui":"Non","M\xe9thode de paiement":e.paymentMethod||"N/A","Adresse de livraison":`${e.shippingAddress.street}, ${e.shippingAddress.city}, ${e.shippingAddress.postalCode}`}))),t=$r.Wp.json_to_sheet(r);$r.Wp.book_append_sheet(e,t,"Commandes");const s=Z().map((e=>({Statut:e.name,"Nombre de commandes":e.count}))),n=$r.Wp.json_to_sheet(s);$r.Wp.book_append_sheet(e,n,"Statuts des commandes");const a=J().map((e=>({Mois:e.name,"Nombre de commandes":e.totalOrders,"Chiffre d'affaires":e.totalRevenue.toFixed(2),"Valeur moyenne des commandes":e.averageOrderValue.toFixed(2)}))),o=$r.Wp.json_to_sheet(a);$r.Wp.book_append_sheet(e,o,"Statistiques mensuelles"),$r._h(e,`Rapport_Commandes_${(0,$.A)(new Date,"yyyy-MM-dd")}.xlsx`),z.oR.success("Donn\xe9es export\xe9es avec succ\xe8s")};(0,s.useEffect)((()=>{if(!A.trim())return void d(i);const e=A.toLowerCase(),r=i.filter((r=>r.orderNumber.toLowerCase().includes(e)||`${r.customer.firstName} ${r.customer.lastName}`.toLowerCase().includes(e)||r.customer.email.toLowerCase().includes(e)||r.customer.phone.includes(A)));d(r)}),[A,i]),(0,s.useEffect)((()=>{i.length>0&&Q()}),[i,b.startDate,b.endDate]);const ee=()=>{g(""),f(""),C({startDate:null,endDate:null})},re=e=>{const r=H.find((r=>r.value===e));return r?r.color:"default"};return(0,T.jsxs)(l.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h4",sx:{mb:3},children:"Gestion des commandes"}),(0,T.jsxs)(br.A,{value:r,onChange:(e,r)=>{t(r)},sx:{mb:3},variant:"scrollable",children:[(0,T.jsx)(Cr.A,{label:"Liste des commandes"}),(0,T.jsx)(Cr.A,{label:"Statistiques"})]}),0===r&&(0,T.jsxs)(l.A,{children:[(0,T.jsxs)(me.A,{sx:{p:2,mb:3},children:[(0,T.jsxs)(be.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,md:4,children:(0,T.jsx)(je.A,{fullWidth:!0,placeholder:"Rechercher une commande...",value:A,onChange:e=>g(e.target.value),InputProps:{startAdornment:(0,T.jsx)(_r.A,{sx:{mr:1,color:"text.secondary"}})}})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:8,children:(0,T.jsxs)(l.A,{sx:{display:"flex",gap:2},children:[(0,T.jsx)(P.A,{variant:w?"contained":"outlined",startIcon:(0,T.jsx)(Dr.A,{}),onClick:()=>S(!w),children:"Filtres"}),(0,T.jsx)(P.A,{variant:"outlined",startIcon:(0,T.jsx)(Rr.A,{}),onClick:()=>{(async()=>{try{u(!0);let e={};y&&(e.status=y),b.startDate&&b.endDate&&(e.startDate=b.startDate.toISOString(),e.endDate=b.endDate.toISOString());const r=await B.A.get("/orders",{params:e});r.data.success&&(n(r.data.data),d(r.data.data)),u(!1)}catch(x){console.error("Erreur lors du chargement des commandes:",x),j("Impossible de charger les commandes. Veuillez r\xe9essayer plus tard."),u(!1)}})(),Q()},children:"Actualiser"}),(0,T.jsx)(P.A,{variant:"outlined",startIcon:(0,T.jsx)(Ir.A,{}),onClick:X,children:"Exporter (Excel)"})]})})]}),(0,T.jsx)(O.A,{in:w,children:(0,T.jsx)(l.A,{sx:{mt:3},children:(0,T.jsxs)(be.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,md:3,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,children:[(0,T.jsx)(Ue.A,{children:"Statut"}),(0,T.jsxs)(Oe.A,{value:y,onChange:e=>f(e.target.value),label:"Statut",children:[(0,T.jsx)(v.A,{value:"",children:"Tous"}),H.map((e=>(0,T.jsx)(v.A,{value:e.value,children:e.label},e.value)))]})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:3,children:(0,T.jsx)(Wr.$,{dateAdapter:qr.h,locale:F.A,children:(0,T.jsx)(Nr.l,{label:"Date de d\xe9but",value:b.startDate,onChange:e=>C({...b,startDate:e}),renderInput:e=>(0,T.jsx)(je.A,{...e,fullWidth:!0})})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:3,children:(0,T.jsx)(Wr.$,{dateAdapter:qr.h,locale:F.A,children:(0,T.jsx)(Nr.l,{label:"Date de fin",value:b.endDate,onChange:e=>C({...b,endDate:e}),renderInput:e=>(0,T.jsx)(je.A,{...e,fullWidth:!0})})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:3,children:(0,T.jsx)(P.A,{variant:"outlined",color:"error",startIcon:(0,T.jsx)(kr.A,{}),onClick:ee,fullWidth:!0,children:"Effacer les filtres"})})]})})})]}),c?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,T.jsx)(_.A,{})}):x?(0,T.jsx)(pe.A,{severity:"error",sx:{mb:3},children:x}):0===o.length?(0,T.jsx)(pe.A,{severity:"info",children:"Aucune commande ne correspond \xe0 vos crit\xe8res de recherche."}):(0,T.jsx)(Se.A,{component:me.A,children:(0,T.jsxs)(Pe.A,{children:[(0,T.jsx)(_e.A,{children:(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:"N\xb0 de commande"}),(0,T.jsx)(Re.A,{children:"Date"}),(0,T.jsx)(Re.A,{children:"Client"}),(0,T.jsx)(Re.A,{children:"Montant"}),(0,T.jsx)(Re.A,{children:"Statut"}),(0,T.jsx)(Re.A,{children:"Paiement"}),(0,T.jsx)(Re.A,{align:"center",children:"Actions"})]})}),(0,T.jsx)(Ie.A,{children:o.map((e=>(0,T.jsxs)(De.A,{hover:!0,children:[(0,T.jsx)(Re.A,{children:e.orderNumber}),(0,T.jsx)(Re.A,{children:new Date(e.createdAt).toLocaleDateString("fr-FR")}),(0,T.jsxs)(Re.A,{children:[(0,T.jsxs)(m.A,{variant:"body2",children:[e.customer.firstName," ",e.customer.lastName]}),(0,T.jsx)(m.A,{variant:"caption",color:"text.secondary",children:e.customer.email})]}),(0,T.jsxs)(Re.A,{children:[e.totalAmount.toFixed(2)," \u20ac"]}),(0,T.jsx)(Re.A,{children:(0,T.jsx)(Le.A,{label:e.status,color:re(e.status),size:"small"})}),(0,T.jsx)(Re.A,{children:(0,T.jsx)(Le.A,{label:e.isPaid?"Pay\xe9e":"En attente",color:e.isPaid?"success":"default",size:"small",variant:e.isPaid?"filled":"outlined"})}),(0,T.jsxs)(Re.A,{align:"center",children:[(0,T.jsx)(p.A,{title:"Voir les d\xe9tails",children:(0,T.jsx)(h.A,{color:"primary",onClick:()=>(e=>{q(e),N(!0)})(e),children:(0,T.jsx)(Er.A,{})})}),(0,T.jsx)(p.A,{title:"Modifier le statut",children:(0,T.jsx)(h.A,{color:"secondary",onClick:()=>(e=>{U(e),L(!0)})(e),children:(0,T.jsx)(Me.A,{})})})]})]},e._id)))})]})})]}),1===r&&(()=>{var r,t;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(br.A,{value:I,onChange:(e,r)=>k(r),indicatorColor:"primary",textColor:"primary",centered:!0,sx:{mb:3},children:[(0,T.jsx)(Cr.A,{icon:(0,T.jsx)(wr.A,{}),label:"Vue d'ensemble"}),(0,T.jsx)(Cr.A,{icon:(0,T.jsx)(Sr.A,{}),label:"Tendances"}),(0,T.jsx)(Cr.A,{icon:(0,T.jsx)(Pr.A,{}),label:"R\xe9partition"})]}),0===I&&(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,md:4,children:(0,T.jsx)(Ze.A,{sx:{height:"100%",bgcolor:e.palette.primary.light,color:"white"},children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Total des commandes"}),(0,T.jsx)(m.A,{variant:"h3",children:K.totalOrders})]})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:4,children:(0,T.jsx)(Ze.A,{sx:{height:"100%",bgcolor:e.palette.success.light,color:"white"},children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Chiffre d'affaires"}),(0,T.jsxs)(m.A,{variant:"h3",children:[K.totalRevenue.toFixed(2)," \u20ac"]})]})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:4,children:(0,T.jsx)(Ze.A,{sx:{height:"100%",bgcolor:e.palette.warning.light,color:"white"},children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Commandes en attente"}),(0,T.jsx)(m.A,{variant:"h3",children:(null===(r=K.ordersByStatus)||void 0===r||null===(t=r.find((e=>"en attente"===e._id)))||void 0===t?void 0:t.count)||0})]})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Commandes par statut"}),(0,T.jsx)(Fr.u,{width:"100%",height:300,children:(0,T.jsxs)(Br.E,{data:Z(),margin:{top:20,right:30,left:20,bottom:5},children:[(0,T.jsx)(zr.d,{strokeDasharray:"3 3"}),(0,T.jsx)(Tr.W,{dataKey:"name"}),(0,T.jsx)(Lr.h,{}),(0,T.jsx)(Vr.m,{}),(0,T.jsx)(Ur.s,{}),(0,T.jsx)(Or.y,{dataKey:"count",name:"Nombre de commandes",fill:"#8884d8"})]})})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"R\xe9partition des commandes par tranche de prix"}),(0,T.jsx)(Fr.u,{width:"100%",height:300,children:(0,T.jsxs)(Kr.r,{children:[(0,T.jsx)(Gr.F,{data:Y(),cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",label:e=>{let{name:r,percent:t}=e;return`${r} ${(100*t).toFixed(0)}%`},children:Y().map(((e,r)=>(0,T.jsx)(Hr.f,{fill:tt[r%tt.length]},`cell-${r}`)))}),(0,T.jsx)(Vr.m,{})]})})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Top 10 Clients"}),(0,T.jsx)(Se.A,{children:(0,T.jsxs)(Pe.A,{children:[(0,T.jsx)(_e.A,{children:(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:"Client"}),(0,T.jsx)(Re.A,{align:"right",children:"Nombre de commandes"}),(0,T.jsx)(Re.A,{align:"right",children:"Montant total"})]})}),(0,T.jsx)(Ie.A,{children:Object.entries(i.reduce(((e,r)=>{const t=`${r.customer.firstName} ${r.customer.lastName}`;return e[t]=e[t]||{count:0,total:0,email:r.customer.email},e[t].count++,e[t].total+=r.totalAmount,e}),{})).sort(((e,r)=>r[1].count-e[1].count)).slice(0,10).map((e=>{let[r,t]=e;return(0,T.jsxs)(De.A,{children:[(0,T.jsxs)(Re.A,{children:[r,(0,T.jsx)(m.A,{variant:"caption",color:"text.secondary",display:"block",children:t.email})]}),(0,T.jsx)(Re.A,{align:"right",children:t.count}),(0,T.jsxs)(Re.A,{align:"right",children:[t.total.toFixed(2)," \u20ac"]})]},r)}))})]})})]})})]}),1===I&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.A,{sx:{mb:3,display:"flex",justifyContent:"flex-end"},children:(0,T.jsxs)(Ve.A,{sx:{minWidth:150},children:[(0,T.jsx)(Ue.A,{id:"period-label",children:"P\xe9riode"}),(0,T.jsxs)(Oe.A,{labelId:"period-label",value:D,onChange:e=>R(e.target.value),label:"P\xe9riode",children:[(0,T.jsx)(v.A,{value:"3months",children:"3 derniers mois"}),(0,T.jsx)(v.A,{value:"6months",children:"6 derniers mois"}),(0,T.jsx)(v.A,{value:"12months",children:"12 derniers mois"})]})]})}),(0,T.jsx)(be.Ay,{container:!0,spacing:3,children:(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"\xc9volution mensuelle des commandes"}),(0,T.jsx)(Fr.u,{width:"100%",height:400,children:(0,T.jsxs)(Qr.b,{data:J(),margin:{top:20,right:30,left:20,bottom:5},children:[(0,T.jsx)(zr.d,{strokeDasharray:"3 3"}),(0,T.jsx)(Tr.W,{dataKey:"name"}),(0,T.jsx)(Lr.h,{yAxisId:"left"}),(0,T.jsx)(Lr.h,{yAxisId:"right",orientation:"right"}),(0,T.jsx)(Vr.m,{}),(0,T.jsx)(Ur.s,{}),(0,T.jsx)(Zr.N,{yAxisId:"left",type:"monotone",dataKey:"totalOrders",name:"Nombre de commandes",stroke:"#8884d8",activeDot:{r:8}}),(0,T.jsx)(Zr.N,{yAxisId:"right",type:"monotone",dataKey:"totalRevenue",name:"Chiffre d'affaires",stroke:"#82ca9d"}),(0,T.jsx)(Zr.N,{yAxisId:"left",type:"monotone",dataKey:"averageOrderValue",name:"Valeur moyenne",stroke:"#ff7300"})]})})]})})})]}),2===I&&(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"R\xe9partition des commandes par statut"}),(0,T.jsx)(Fr.u,{width:"100%",height:400,children:(0,T.jsxs)(Kr.r,{children:[(0,T.jsx)(Gr.F,{data:Z(),cx:"50%",cy:"50%",labelLine:!1,outerRadius:150,fill:"#8884d8",dataKey:"count",label:e=>{let{name:r,percent:t}=e;return t>.05?`${r} ${(100*t).toFixed(0)}%`:""},children:Z().map(((e,r)=>(0,T.jsx)(Hr.f,{fill:tt[r%tt.length]},`cell-${r}`)))}),(0,T.jsx)(Vr.m,{})]})})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"R\xe9partition des m\xe9thodes de paiement"}),(0,T.jsx)(Fr.u,{width:"100%",height:400,children:(0,T.jsxs)(Kr.r,{children:[(0,T.jsx)(Gr.F,{data:Object.entries(i.reduce(((e,r)=>{const t=r.paymentMethod||"Non sp\xe9cifi\xe9";return e[t]=(e[t]||0)+1,e}),{})).map((e=>{let[r,t]=e;return{name:r,value:t}})),cx:"50%",cy:"50%",labelLine:!1,outerRadius:150,fill:"#8884d8",dataKey:"value",label:e=>{let{name:r,percent:t}=e;return t>.05?`${r} ${(100*t).toFixed(0)}%`:""},children:Object.entries(i.reduce(((e,r)=>{const t=r.paymentMethod||"Non sp\xe9cifi\xe9";return e[t]=(e[t]||0)+1,e}),{})).map(((e,r)=>{let[t,s]=e;return(0,T.jsx)(Hr.f,{fill:tt[r%tt.length]},`cell-${r}`)}))}),(0,T.jsx)(Vr.m,{})]})})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"D\xe9lais de traitement des commandes"}),(0,T.jsx)(Fr.u,{width:"100%",height:300,children:(0,T.jsxs)(Br.E,{data:[{name:"< 1 jour",value:i.filter((e=>new Date(e.updatedAt)-new Date(e.createdAt)<864e5)).length},{name:"1-3 jours",value:i.filter((e=>{const r=new Date(e.updatedAt)-new Date(e.createdAt);return r>=864e5&&r<2592e5})).length},{name:"3-7 jours",value:i.filter((e=>{const r=new Date(e.updatedAt)-new Date(e.createdAt);return r>=2592e5&&r<6048e5})).length},{name:"> 7 jours",value:i.filter((e=>new Date(e.updatedAt)-new Date(e.createdAt)>=6048e5)).length}],margin:{top:20,right:30,left:20,bottom:5},children:[(0,T.jsx)(zr.d,{strokeDasharray:"3 3"}),(0,T.jsx)(Tr.W,{dataKey:"name"}),(0,T.jsx)(Lr.h,{}),(0,T.jsx)(Vr.m,{}),(0,T.jsx)(Ur.s,{}),(0,T.jsx)(Or.y,{dataKey:"value",name:"Nombre de commandes",fill:"#8884d8",children:[{name:"< 1 jour",value:i.filter((e=>new Date(e.updatedAt)-new Date(e.createdAt)<864e5)).length},{name:"1-3 jours",value:i.filter((e=>{const r=new Date(e.updatedAt)-new Date(e.createdAt);return r>=864e5&&r<2592e5})).length},{name:"3-7 jours",value:i.filter((e=>{const r=new Date(e.updatedAt)-new Date(e.createdAt);return r>=2592e5&&r<6048e5})).length},{name:"> 7 jours",value:i.filter((e=>new Date(e.updatedAt)-new Date(e.createdAt)>=6048e5)).length}].map(((e,r)=>(0,T.jsx)(Hr.f,{fill:tt[r%tt.length]},`cell-${r}`)))})]})})]})})]})]})})(),(0,T.jsxs)(ke.A,{open:W,onClose:()=>N(!1),fullWidth:!0,maxWidth:"md",children:[(0,T.jsxs)(Ee.A,{children:["D\xe9tails de la commande ",null===E||void 0===E?void 0:E.orderNumber]}),(0,T.jsx)(qe.A,{dividers:!0,children:E&&(0,T.jsx)(et,{order:E})}),(0,T.jsx)(We.A,{children:(0,T.jsx)(P.A,{onClick:()=>N(!1),children:"Fermer"})})]}),(0,T.jsx)(rt,{open:M,onClose:()=>{L(!1),U(null)},onUpdateStatus:async(e,r)=>{try{if(!V)return;const t=await B.A.patch(`/orders/${V._id}/status`,{status:e,comment:r});t.data.success&&(n((e=>e.map((e=>e._id===V._id?t.data.data:e)))),L(!1),U(null),Q())}catch(x){console.error("Erreur lors de la mise \xe0 jour du statut:",x),j("Impossible de mettre \xe0 jour le statut. Veuillez r\xe9essayer plus tard.")}},order:V,statuses:H})]})};var it=t(25713),nt=t(50675);const at=()=>{var e,r,t,i;const[n,a]=(0,s.useState)([]),[o,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(!0),[x,j]=(0,s.useState)(!1),[A,g]=(0,s.useState)({productId:"",discountedPrice:"",discountDuration:(0,$.A)(new Date(Date.now()+6048e5),"yyyy-MM-dd")}),[y,f]=(0,s.useState)({open:!1,id:null}),[b,C]=(0,s.useState)(""),[w,S]=(0,s.useState)(1),[D]=(0,s.useState)(10),[R,I]=(0,s.useState)("grid");(0,s.useEffect)((()=>{k()}),[]);const k=async()=>{try{u(!0);const e=await B.A.get("/products");a(e.data);const r=e.data.filter((e=>e.discountedPrice&&new Date(e.discountDuration)>new Date));d(r),u(!1)}catch(e){console.error("Erreur lors du chargement des donn\xe9es:",e),z.oR.error("Erreur lors du chargement des donn\xe9es"),u(!1)}},E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var r;e?g({productId:e._id,discountedPrice:(null===(r=e.discountedPrice)||void 0===r?void 0:r.toString())||"",discountDuration:e.discountDuration?(0,$.A)(new Date(e.discountDuration),"yyyy-MM-dd"):(0,$.A)(new Date(Date.now()+6048e5),"yyyy-MM-dd")}):g({productId:"",discountedPrice:"",discountDuration:(0,$.A)(new Date(Date.now()+6048e5),"yyyy-MM-dd")});j(!0)},q=()=>{j(!1)},W=e=>{const{name:r,value:t}=e.target;g({...A,[r]:t})},N=e=>{f({open:!0,id:e})},F=o.filter((e=>e.nom.toLowerCase().includes(b.toLowerCase())||e.Company_id.nom&&e.Company_id.nom.toLowerCase().includes(b.toLowerCase()))),L=F.slice((w-1)*D,w*D),V=(e,r)=>Math.round(100*(1-r/e));return c?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,T.jsx)(_.A,{})}):(0,T.jsxs)("div",{children:[(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:3,alignItems:"center"},children:[(0,T.jsx)(m.A,{variant:"h4",children:"Gestion des Promotions"}),(0,T.jsxs)(l.A,{sx:{display:"flex",gap:2},children:[(0,T.jsx)(je.A,{size:"small",placeholder:"Rechercher...",value:b,onChange:e=>C(e.target.value),InputProps:{startAdornment:(0,T.jsx)(tr.A,{position:"start",children:(0,T.jsx)(_r.A,{})})},sx:{width:250}}),(0,T.jsx)(P.A,{variant:"contained",startIcon:(0,T.jsx)(Ne.A,{}),onClick:()=>E(),children:"Ajouter une promotion"}),(0,T.jsx)(P.A,{variant:"outlined",onClick:()=>I("grid"===R?"table":"grid"),children:"grid"===R?"Vue tableau":"Vue grille"})]})]}),(0,T.jsxs)(l.A,{sx:{mb:2,display:"flex",alignItems:"center"},children:[(0,T.jsx)(X.A,{color:"error",sx:{mr:1}}),(0,T.jsxs)(m.A,{variant:"h6",children:[F.length," produits en promotion"]})]}),"grid"===R?(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(be.Ay,{container:!0,spacing:3,children:L.length>0?L.map((e=>{var r;return(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,T.jsxs)(Ze.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,T.jsxs)(l.A,{sx:{position:"relative"},children:[(0,T.jsx)(Ye.A,{component:"img",height:"140",image:e.mainPicture||"/placeholder-image.jpg",alt:e.nom}),(0,T.jsxs)(l.A,{sx:{position:"absolute",top:10,right:10,backgroundColor:"error.main",color:"white",padding:"4px 8px",borderRadius:1,fontWeight:"bold"},children:["-",V(e.oldPrice,e.discountedPrice),"%"]})]}),(0,T.jsxs)(Je.A,{sx:{flexGrow:1},children:[(0,T.jsx)(m.A,{gutterBottom:!0,variant:"h6",component:"div",noWrap:!0,children:e.nom}),(0,T.jsx)(m.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:(null===(r=e.Company_id)||void 0===r?void 0:r.nom)||"N/A"}),(0,T.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,T.jsxs)(m.A,{variant:"body2",color:"text.secondary",sx:{textDecoration:"line-through",mr:1},children:[e.oldPrice," \u20ac"]}),(0,T.jsxs)(m.A,{variant:"body1",color:"error.main",fontWeight:"bold",children:[e.discountedPrice," \u20ac"]})]}),(0,T.jsx)(l.A,{sx:{mt:1},children:(0,T.jsx)(Le.A,{label:`Jusqu'au ${(0,$.A)(new Date(e.discountDuration),"dd/MM/yyyy")}`,color:"primary",size:"small"})})]}),(0,T.jsxs)(it.A,{sx:{p:2},children:[(0,T.jsx)(p.A,{title:"Modifier la promotion",children:(0,T.jsx)(h.A,{onClick:()=>E(e),children:(0,T.jsx)(Me.A,{})})}),(0,T.jsx)(p.A,{title:"Supprimer la promotion",children:(0,T.jsx)(h.A,{color:"error",onClick:()=>N(e._id),children:(0,T.jsx)(M.A,{})})})]})]})},e._id)})):(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(me.A,{sx:{p:3,textAlign:"center"},children:(0,T.jsx)(m.A,{children:"Aucune promotion trouv\xe9e"})})})})}):(0,T.jsx)(Se.A,{component:me.A,children:(0,T.jsxs)(Pe.A,{children:[(0,T.jsx)(_e.A,{children:(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:"Image"}),(0,T.jsx)(Re.A,{children:"Produit"}),(0,T.jsx)(Re.A,{children:"Marque"}),(0,T.jsx)(Re.A,{children:"Prix normal"}),(0,T.jsx)(Re.A,{children:"Prix promo"}),(0,T.jsx)(Re.A,{children:"R\xe9duction"}),(0,T.jsx)(Re.A,{children:"Jusqu'au"}),(0,T.jsx)(Re.A,{children:"Actions"})]})}),(0,T.jsx)(Ie.A,{children:L.length>0?L.map((e=>{var r;return(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:(0,T.jsx)(l.A,{sx:{width:60,height:60},children:(0,T.jsx)("img",{src:e.mainPicture||"/placeholder-image.jpg",alt:e.nom,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}})})}),(0,T.jsx)(Re.A,{children:e.nom}),(0,T.jsx)(Re.A,{children:(null===(r=e.Company_id)||void 0===r?void 0:r.nom)||"N/A"}),(0,T.jsxs)(Re.A,{children:[e.oldPrice," \u20ac"]}),(0,T.jsxs)(Re.A,{children:[e.discountedPrice," \u20ac"]}),(0,T.jsx)(Re.A,{children:(0,T.jsx)(Le.A,{label:`-${V(e.oldPrice,e.discountedPrice)}%`,color:"error",size:"small"})}),(0,T.jsx)(Re.A,{children:(0,$.A)(new Date(e.discountDuration),"dd/MM/yyyy")}),(0,T.jsxs)(Re.A,{children:[(0,T.jsx)(h.A,{onClick:()=>E(e),children:(0,T.jsx)(Me.A,{})}),(0,T.jsx)(h.A,{color:"error",onClick:()=>N(e._id),children:(0,T.jsx)(M.A,{})})]})]},e._id)})):(0,T.jsx)(De.A,{children:(0,T.jsx)(Re.A,{colSpan:8,align:"center",children:"Aucune promotion trouv\xe9e"})})})]})}),(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:3},children:(0,T.jsx)(He.A,{count:Math.ceil(F.length/D),page:w,onChange:(e,r)=>{S(r)},color:"primary",showFirstButton:!0,showLastButton:!0})}),(0,T.jsxs)(ke.A,{open:x,onClose:q,fullWidth:!0,maxWidth:"sm",children:[(0,T.jsx)(Ee.A,{children:A.productId?"Modifier la promotion":"Ajouter une promotion"}),(0,T.jsxs)(qe.A,{children:[!A.productId&&(0,T.jsxs)(Ve.A,{fullWidth:!0,margin:"normal",children:[(0,T.jsx)(Ue.A,{id:"product-select-label",children:"Produit"}),(0,T.jsx)(Oe.A,{labelId:"product-select-label",name:"productId",value:A.productId,onChange:W,label:"Produit",required:!0,children:n.filter((e=>!e.discountedPrice)).map((e=>{var r;return(0,T.jsxs)(v.A,{value:e._id,children:[e.nom," - ",e.oldPrice," \u20ac (",(null===(r=e.Company_id)||void 0===r?void 0:r.nom)||"N/A",")"]},e._id)}))})]}),A.productId&&n.find((e=>e._id===A.productId))&&(0,T.jsx)(l.A,{sx:{mb:2,mt:2},children:(0,T.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,T.jsx)(l.A,{sx:{width:60,height:60,mr:2},children:(0,T.jsx)("img",{src:(null===(e=n.find((e=>e._id===A.productId)))||void 0===e?void 0:e.mainPicture)||"/placeholder-image.jpg",alt:"Product",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}})}),(0,T.jsxs)(l.A,{children:[(0,T.jsx)(m.A,{variant:"subtitle1",children:null===(r=n.find((e=>e._id===A.productId)))||void 0===r?void 0:r.nom}),(0,T.jsxs)(m.A,{variant:"body2",color:"text.secondary",children:["Prix normal: ",null===(t=n.find((e=>e._id===A.productId)))||void 0===t?void 0:t.oldPrice," \u20ac"]})]})]})}),(0,T.jsx)(je.A,{name:"discountedPrice",label:"Prix r\xe9duit (\u20ac)",fullWidth:!0,type:"number",margin:"normal",value:A.discountedPrice,onChange:W,required:!0,InputProps:{startAdornment:(0,T.jsx)(tr.A,{position:"start",children:"\u20ac"})}}),(0,T.jsx)(je.A,{name:"discountDuration",label:"Valable jusqu'au",type:"date",fullWidth:!0,margin:"normal",value:A.discountDuration,onChange:W,InputLabelProps:{shrink:!0}}),A.productId&&A.discountedPrice&&(0,T.jsxs)(l.A,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:1},children:[(0,T.jsx)(m.A,{variant:"subtitle2",gutterBottom:!0,children:"Aper\xe7u de la promotion"}),(0,T.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,T.jsx)(nt.A,{color:"error",sx:{mr:1}}),(0,T.jsxs)(m.A,{children:["R\xe9duction de ",V((null===(i=n.find((e=>e._id===A.productId)))||void 0===i?void 0:i.oldPrice)||0,parseFloat(A.discountedPrice)),"%"]})]})]})]}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:q,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:async()=>{try{await B.A.put(`/products/${A.productId}/discount`,{discountedPrice:A.discountedPrice,discountDuration:A.discountDuration}),z.oR.success("Promotion appliqu\xe9e avec succ\xe8s"),q(),k()}catch(e){console.error("Erreur lors de l'application de la promotion:",e),z.oR.error("Erreur lors de l'application de la promotion")}},variant:"contained",disabled:!A.productId||!A.discountedPrice,children:A.productId?"Mettre \xe0 jour":"Ajouter"})]})]}),(0,T.jsx)(Fe,{open:y.open,title:"Confirmer la suppression",message:"\xcates-vous s\xfbr de vouloir supprimer cette promotion? Le produit sera remis au prix normal.",onConfirm:async()=>{try{await B.A.delete(`/products/${y.id}/discount`),z.oR.success("Promotion supprim\xe9e avec succ\xe8s"),k()}catch(e){console.error("Erreur lors de la suppression de la promotion:",e),z.oR.error("Erreur lors de la suppression de la promotion")}finally{f({open:!1,id:null})}},onCancel:()=>f({open:!1,id:null})})]})};var ot=t(29137),lt=t(94289),dt=t(57326);const ct=["#0088FE","#00C49F","#FFBB28","#FF8042","#A52A2A","#7B68EE","#FF6347","#20B2AA"];const ut=function(){const[e,r]=(0,s.useState)(!0),[t,i]=(0,s.useState)(null),[n,a]=(0,s.useState)([]),[o,d]=(0,s.useState)([]),[c,u]=(0,s.useState)([]),[x,h]=(0,s.useState)("3months"),[p,j]=(0,s.useState)(0),[A,g]=(0,s.useState)([]),[y,f]=(0,s.useState)([]);(0,s.useEffect)((()=>{b()}),[]);const b=async()=>{try{r(!0);const e=await B.A.get("/stats");i(e.data);const t=await B.A.get("/categories");a(t.data);const s=await B.A.get("/companies");d(s.data);const n=await B.A.get("/products");u(n.data),C(n.data,t.data),w(n.data,s.data),r(!1)}catch(e){console.error("Erreur lors du chargement des donn\xe9es:",e),z.oR.error("Impossible de charger les donn\xe9es statistiques"),r(!1)}},C=(e,r)=>{const t=r.map((r=>{const t=e.filter((e=>e.categoriesa_id.some((e=>("object"===typeof e?e._id:e)===r._id)))).length;return{name:r.name,count:t}})).sort(((e,r)=>r.count-e.count));g(t)},w=(e,r)=>{const t=r.map((r=>{const t=e.filter((e=>("object"===typeof e.Company_id?e.Company_id._id:e.Company_id)===r._id)).length;return{name:r.nom,count:t}})).sort(((e,r)=>r.count-e.count));f(t)};return e?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,T.jsx)(_.A,{})}):(0,T.jsxs)("div",{children:[(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,T.jsx)(m.A,{variant:"h4",children:"Statistiques et Analyses"}),(0,T.jsx)(P.A,{variant:"contained",startIcon:(0,T.jsx)(ot.A,{}),onClick:()=>{const e=$r.Wp.book_new(),r=c.map((e=>({ID:e._id,Nom:e.nom,Description:e.description||"",Prix:e.oldPrice,"Prix remis\xe9":e.discountedPrice||"","Quantit\xe9":e.quantite||0,Entreprise:e.Company_id.nom||"","Cat\xe9gories":e.categoriesa_id.map((e=>e.name)).join(", "),"Sous-cat\xe9gories":e.subcategories_id.map((e=>e.name)).join(", "),"Date de cr\xe9ation":new Date(e.createdAt).toLocaleDateString("fr-FR")}))),t=$r.Wp.json_to_sheet(r);$r.Wp.book_append_sheet(e,t,"Produits");const s=n.map((e=>{var r;return{ID:e._id,Nom:e.name,Description:e.description||"","Nombre de produits":(null===(r=A.find((r=>r.name===e.name)))||void 0===r?void 0:r.count)||0}})),i=$r.Wp.json_to_sheet(s);$r.Wp.book_append_sheet(e,i,"Cat\xe9gories");const a=o.map((e=>{var r;return{ID:e._id,Nom:e.nom,"Nombre de produits":(null===(r=y.find((r=>r.name===e.nom)))||void 0===r?void 0:r.count)||0,"Cat\xe9gories":e.categories_id.map((e=>e.name)).join(", ")}})),l=$r.Wp.json_to_sheet(a);$r.Wp.book_append_sheet(e,l,"Entreprises"),$r._h(e,`Catalogue_Export_${(0,$.A)(new Date,"yyyy-MM-dd")}.xlsx`),z.oR.success("Donn\xe9es export\xe9es avec succ\xe8s")},children:"Exporter en Excel"})]}),(0,T.jsxs)(br.A,{value:p,onChange:(e,r)=>{j(r)},indicatorColor:"primary",textColor:"primary",centered:!0,sx:{mb:3},children:[(0,T.jsx)(Cr.A,{icon:(0,T.jsx)(wr.A,{}),label:"Vue d'ensemble"}),(0,T.jsx)(Cr.A,{icon:(0,T.jsx)(Sr.A,{}),label:"Tendances"}),(0,T.jsx)(Cr.A,{icon:(0,T.jsx)(Pr.A,{}),label:"R\xe9partition"})]}),0===p&&(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,md:4,children:(0,T.jsx)(Ze.A,{sx:{height:"100%"},children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"R\xe9sum\xe9 du catalogue"}),(0,T.jsxs)(l.A,{sx:{mt:2},children:[(0,T.jsxs)(m.A,{variant:"body1",children:[(0,T.jsx)("strong",{children:"Nombre de cat\xe9gories:"})," ",(null===t||void 0===t?void 0:t.categories)||0]}),(0,T.jsxs)(m.A,{variant:"body1",children:[(0,T.jsx)("strong",{children:"Nombre d'entreprises:"})," ",(null===t||void 0===t?void 0:t.companies)||0]}),(0,T.jsxs)(m.A,{variant:"body1",children:[(0,T.jsx)("strong",{children:"Nombre de produits:"})," ",(null===t||void 0===t?void 0:t.products)||0]}),(0,T.jsxs)(m.A,{variant:"body1",children:[(0,T.jsx)("strong",{children:"Produits en promotion:"})," ",c.filter((e=>e.discountedPrice&&new Date(e.discountDuration)>new Date)).length]})]})]})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:8,children:(0,T.jsxs)(me.A,{sx:{p:3,height:"100%"},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Top 5 cat\xe9gories par nombre de produits"}),(0,T.jsx)(Fr.u,{width:"100%",height:300,children:(0,T.jsxs)(Br.E,{data:A.slice(0,5),margin:{top:20,right:30,left:20,bottom:5},children:[(0,T.jsx)(zr.d,{strokeDasharray:"3 3"}),(0,T.jsx)(Tr.W,{dataKey:"name"}),(0,T.jsx)(Lr.h,{}),(0,T.jsx)(Vr.m,{}),(0,T.jsx)(Ur.s,{}),(0,T.jsx)(Or.y,{dataKey:"count",name:"Nombre de produits",fill:"#8884d8"})]})})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Top 5 entreprises par nombre de produits"}),(0,T.jsx)(Fr.u,{width:"100%",height:300,children:(0,T.jsxs)(Br.E,{data:y.slice(0,5),margin:{top:20,right:30,left:20,bottom:5},children:[(0,T.jsx)(zr.d,{strokeDasharray:"3 3"}),(0,T.jsx)(Tr.W,{dataKey:"name"}),(0,T.jsx)(Lr.h,{}),(0,T.jsx)(Vr.m,{}),(0,T.jsx)(Ur.s,{}),(0,T.jsx)(Or.y,{dataKey:"count",name:"Nombre de produits",fill:"#82ca9d"})]})})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"R\xe9partition des produits par gamme de prix"}),(0,T.jsx)(Fr.u,{width:"100%",height:300,children:(0,T.jsxs)(Kr.r,{children:[(0,T.jsx)(Gr.F,{data:[{name:"< 10\u20ac",value:c.filter((e=>e.oldPrice<10)).length},{name:"10-50\u20ac",value:c.filter((e=>e.oldPrice>=10&&e.oldPrice<50)).length},{name:"50-100\u20ac",value:c.filter((e=>e.oldPrice>=50&&e.oldPrice<100)).length},{name:"100-500\u20ac",value:c.filter((e=>e.oldPrice>=100&&e.oldPrice<500)).length},{name:"> 500\u20ac",value:c.filter((e=>e.oldPrice>=500)).length}],cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",label:e=>{let{name:r,percent:t}=e;return`${r} ${(100*t).toFixed(0)}%`},children:[{name:"< 10\u20ac",value:c.filter((e=>e.oldPrice<10)).length},{name:"10-50\u20ac",value:c.filter((e=>e.oldPrice>=10&&e.oldPrice<50)).length},{name:"50-100\u20ac",value:c.filter((e=>e.oldPrice>=50&&e.oldPrice<100)).length},{name:"100-500\u20ac",value:c.filter((e=>e.oldPrice>=100&&e.oldPrice<500)).length},{name:"> 500\u20ac",value:c.filter((e=>e.oldPrice>=500)).length}].map(((e,r)=>(0,T.jsx)(Hr.f,{fill:ct[r%ct.length]},`cell-${r}`)))}),(0,T.jsx)(Vr.m,{})]})})]})})]}),1===p&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.A,{sx:{mb:3,display:"flex",justifyContent:"flex-end"},children:(0,T.jsxs)(Ve.A,{sx:{minWidth:150},children:[(0,T.jsx)(Ue.A,{id:"period-label",children:"P\xe9riode"}),(0,T.jsxs)(Oe.A,{labelId:"period-label",value:x,onChange:e=>{h(e.target.value)},label:"P\xe9riode",children:[(0,T.jsx)(v.A,{value:"3months",children:"3 derniers mois"}),(0,T.jsx)(v.A,{value:"6months",children:"6 derniers mois"}),(0,T.jsx)(v.A,{value:"12months",children:"12 derniers mois"})]})]})}),(0,T.jsx)(be.Ay,{container:!0,spacing:3,children:(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"\xc9volution mensuelle"}),(0,T.jsx)(Fr.u,{width:"100%",height:400,children:(0,T.jsxs)(Qr.b,{data:(()=>{const e=new Date;let r,t=[];switch(x){case"3months":default:r=3;break;case"6months":r=6;break;case"12months":r=12}for(let s=0;s<r;s++){const r=(0,Mr.A)(e,s),i=((0,lt.A)(r),(0,dt.A)(r),{name:(0,$.A)(r,"MMMM yyyy",{locale:F.A}),nouveauxProduits:Math.floor(20*Math.random()),produitsEnPromotion:Math.floor(15*Math.random()),visites:Math.floor(1e3*Math.random())+100});t.push(i)}return t.reverse()})(),margin:{top:20,right:30,left:20,bottom:5},children:[(0,T.jsx)(zr.d,{strokeDasharray:"3 3"}),(0,T.jsx)(Tr.W,{dataKey:"name"}),(0,T.jsx)(Lr.h,{yAxisId:"left"}),(0,T.jsx)(Lr.h,{yAxisId:"right",orientation:"right"}),(0,T.jsx)(Vr.m,{}),(0,T.jsx)(Ur.s,{}),(0,T.jsx)(Zr.N,{yAxisId:"left",type:"monotone",dataKey:"nouveauxProduits",name:"Nouveaux produits",stroke:"#8884d8",activeDot:{r:8}}),(0,T.jsx)(Zr.N,{yAxisId:"left",type:"monotone",dataKey:"produitsEnPromotion",name:"Produits en promotion",stroke:"#82ca9d"}),(0,T.jsx)(Zr.N,{yAxisId:"right",type:"monotone",dataKey:"visites",name:"Visites (simulation)",stroke:"#ff7300"})]})})]})})})]}),2===p&&(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"R\xe9partition des produits par cat\xe9gorie"}),(0,T.jsx)(Fr.u,{width:"100%",height:400,children:(0,T.jsxs)(Kr.r,{children:[(0,T.jsx)(Gr.F,{data:A,cx:"50%",cy:"50%",labelLine:!1,outerRadius:150,fill:"#8884d8",dataKey:"count",label:e=>{let{name:r,percent:t}=e;return t>.05?`${r} ${(100*t).toFixed(0)}%`:""},children:A.map(((e,r)=>(0,T.jsx)(Hr.f,{fill:ct[r%ct.length]},`cell-${r}`)))}),(0,T.jsx)(Vr.m,{})]})})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"R\xe9partition des produits par entreprise"}),(0,T.jsx)(Fr.u,{width:"100%",height:400,children:(0,T.jsxs)(Kr.r,{children:[(0,T.jsx)(Gr.F,{data:y,cx:"50%",cy:"50%",labelLine:!1,outerRadius:150,fill:"#8884d8",dataKey:"count",label:e=>{let{name:r,percent:t}=e;return t>.05?`${r} ${(100*t).toFixed(0)}%`:""},children:y.map(((e,r)=>(0,T.jsx)(Hr.f,{fill:ct[r%ct.length]},`cell-${r}`)))}),(0,T.jsx)(Vr.m,{})]})})]})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"R\xe9partition des produits par niveau de stock"}),(0,T.jsx)(Fr.u,{width:"100%",height:300,children:(0,T.jsxs)(Br.E,{data:[{name:"\xc9puis\xe9 (0)",value:c.filter((e=>0===e.quantite)).length},{name:"Faible (1-10)",value:c.filter((e=>e.quantite>0&&e.quantite<=10)).length},{name:"Moyen (11-50)",value:c.filter((e=>e.quantite>10&&e.quantite<=50)).length},{name:"\xc9lev\xe9 (>50)",value:c.filter((e=>e.quantite>50)).length}],margin:{top:20,right:30,left:20,bottom:5},children:[(0,T.jsx)(zr.d,{strokeDasharray:"3 3"}),(0,T.jsx)(Tr.W,{dataKey:"name"}),(0,T.jsx)(Lr.h,{}),(0,T.jsx)(Vr.m,{}),(0,T.jsx)(Ur.s,{}),(0,T.jsx)(Or.y,{dataKey:"value",name:"Nombre de produits",fill:"#8884d8",children:[{name:"\xc9puis\xe9 (0)",value:c.filter((e=>0===e.quantite)).length},{name:"Faible (1-10)",value:c.filter((e=>e.quantite>0&&e.quantite<=10)).length},{name:"Moyen (11-50)",value:c.filter((e=>e.quantite>10&&e.quantite<=50)).length},{name:"\xc9lev\xe9 (>50)",value:c.filter((e=>e.quantite>50)).length}].map(((e,r)=>(0,T.jsx)(Hr.f,{fill:ct[r%ct.length]},`cell-${r}`)))})]})})]})})]})]})},xt={superAdmin:"Super Admin",productManager:"Responsable des produits",orderManager:"Responsable des commandes",contentEditor:"\xc9diteur de contenu"},ht=()=>{const{currentUser:e,updateProfile:r}=(0,V.A)(),[t,i]=(0,s.useState)(!1),[n,a]=(0,s.useState)({firstName:"",lastName:"",email:"",currentPassword:"",newPassword:"",confirmPassword:""}),[o,d]=(0,s.useState)("");(0,s.useEffect)((()=>{e&&a({...n,firstName:e.firstName||"",lastName:e.lastName||"",email:e.email||""})}),[e]);const c=e=>{const{name:r,value:t}=e.target;a({...n,[r]:t}),["currentPassword","newPassword","confirmPassword"].includes(r)&&d("")},u=e=>{const[r,t]=e.split(".");return`${{create:"Cr\xe9er",read:"Voir",update:"Modifier",delete:"Supprimer"}[t]||t} ${{products:"Produits",categories:"Cat\xe9gories",orders:"Commandes",companies:"Entreprises",admins:"Administrateurs"}[r]||r}`},x=e=>{switch(e){case"create":return"success";case"read":return"info";case"update":return"warning";case"delete":return"error";default:return"default"}};return e?(0,T.jsxs)(l.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h4",gutterBottom:!0,children:"Profil"}),(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,md:4,children:[(0,T.jsx)(Ze.A,{children:(0,T.jsxs)(Je.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,T.jsx)(j.A,{sx:{width:100,height:100,mb:2,bgcolor:"primary.main",fontSize:"3rem"},children:(0,T.jsx)(C.A,{fontSize:"inherit"})}),(0,T.jsx)(m.A,{variant:"h5",gutterBottom:!0,children:e.username}),(0,T.jsx)(Le.A,{label:xt[e.role]||e.role,color:"superAdmin"===e.role?"error":"primary",sx:{mb:2}}),(0,T.jsx)(m.A,{variant:"body2",color:"text.secondary",align:"center",children:`${e.firstName||""} ${e.lastName||""}`.trim()||"Nom non d\xe9fini"}),e.email&&(0,T.jsx)(m.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:e.email})]})}),(0,T.jsx)(Ze.A,{sx:{mt:3},children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Permissions"}),"superAdmin"===e.role?(0,T.jsx)(pe.A,{severity:"info",sx:{mb:2},children:"En tant que Super Admin, vous avez acc\xe8s \xe0 toutes les fonctionnalit\xe9s."}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:(()=>{if(!e||!e.permissions)return[];const r=[];return Object.entries(e.permissions).forEach((e=>{let[t,s]=e;Object.entries(s).forEach((e=>{let[s,i]=e;i&&r.push(`${t}.${s}`)}))})),r})().map((e=>{const[,r]=e.split(".");return(0,T.jsx)(Le.A,{label:u(e),size:"small",color:x(r),variant:"outlined"},e)}))}),(0,T.jsx)(m.A,{variant:"caption",color:"text.secondary",children:"Ces permissions sont d\xe9termin\xe9es par votre r\xf4le. Contactez un Super Admin pour toute modification."})]})]})})]}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:8,children:(0,T.jsxs)(me.A,{sx:{p:3},children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Informations personnelles"}),(0,T.jsx)(g.A,{sx:{mb:3}}),(0,T.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),n.newPassword&&n.newPassword!==n.confirmPassword?(d("Les mots de passe ne correspondent pas."),0):!n.newPassword||n.currentPassword||(d("Veuillez saisir votre mot de passe actuel pour confirmer le changement."),0)){i(!0);try{const e={firstName:n.firstName,lastName:n.lastName,email:n.email};n.newPassword&&(e.currentPassword=n.currentPassword,e.newPassword=n.newPassword);const t=await r(e);t.success?(z.oR.success(t.message),a({...n,currentPassword:"",newPassword:"",confirmPassword:""})):(z.oR.error(t.message),t.message.includes("mot de passe actuel")&&d(t.message))}catch(t){console.error("Erreur lors de la mise \xe0 jour du profil:",t),z.oR.error("Une erreur est survenue lors de la mise \xe0 jour du profil.")}finally{i(!1)}}},children:(0,T.jsxs)(be.Ay,{container:!0,spacing:2,children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Pr\xe9nom",name:"firstName",value:n.firstName,onChange:c})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Nom",name:"lastName",value:n.lastName,onChange:c})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Email",name:"email",type:"email",value:n.email,onChange:c})}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Changer de mot de passe"}),(0,T.jsx)(g.A,{sx:{mb:3}})]}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Mot de passe actuel",name:"currentPassword",type:"password",value:n.currentPassword,onChange:c})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Nouveau mot de passe",name:"newPassword",type:"password",value:n.newPassword,onChange:c})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,sm:6,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Confirmer le nouveau mot de passe",name:"confirmPassword",type:"password",value:n.confirmPassword,onChange:c,error:!!o,helperText:o})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(l.A,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:(0,T.jsx)(P.A,{type:"submit",variant:"contained",color:"primary",startIcon:(0,T.jsx)(lr.A,{}),disabled:t,children:t?"Enregistrement...":"Enregistrer les modifications"})})})]})})]})})]})]}):(0,T.jsx)(l.A,{sx:{p:3},children:(0,T.jsx)(pe.A,{severity:"info",children:"Chargement des informations du profil..."})})};var mt=t(16497),pt=t(80957),jt=t(73759),At=t(41770);const gt=[{value:"superAdmin",label:"Super Admin",description:"Acc\xe8s complet \xe0 toutes les fonctionnalit\xe9s"},{value:"productManager",label:"Responsable des produits",description:"Gestion des produits uniquement"},{value:"orderManager",label:"Responsable des commandes",description:"Gestion des commandes uniquement"},{value:"contentEditor",label:"\xc9diteur de contenu",description:"Gestion des cat\xe9gories et descriptions"}],vt=()=>{const{currentUser:e}=(0,V.A)(),[r,t]=(0,s.useState)([]),[i,n]=(0,s.useState)(!0),[a,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)("add"),[u,x]=(0,s.useState)(null),[j,A]=(0,s.useState)({username:"",password:"",firstName:"",lastName:"",email:"",role:"contentEditor",active:!0}),[g,y]=(0,s.useState)(!1),[f,b]=(0,s.useState)(null);(0,s.useEffect)((()=>{C()}),[]);const C=async()=>{try{n(!0);const e=await dr.A.get("/auth/admins");t(e.data)}catch(e){console.error("Erreur lors du chargement des administrateurs:",e),z.oR.error("Erreur lors du chargement des administrateurs")}finally{n(!1)}},w=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;c(e),x(r),A("edit"===e&&r?{username:r.username,password:"",firstName:r.firstName||"",lastName:r.lastName||"",email:r.email||"",role:r.role,active:!1!==r.active}:{username:"",password:"",firstName:"",lastName:"",email:"",role:"contentEditor",active:!0}),o(!0)},S=()=>{o(!1),x(null)},_=e=>{const{name:r,value:t,type:s,checked:i}=e.target;A({...j,[r]:"checkbox"===s?i:t})},D=()=>{y(!1),b(null)},R=e=>{const r=gt.find((r=>r.value===e));return r?r.label:e},I=r=>e&&e.id===r;return(0,T.jsxs)(l.A,{sx:{padding:3},children:[(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,T.jsx)(m.A,{variant:"h4",component:"h1",children:"Gestion des administrateurs"}),(0,T.jsx)(P.A,{variant:"contained",color:"primary",startIcon:(0,T.jsx)(Ne.A,{}),onClick:()=>w("add"),children:"Ajouter un administrateur"})]}),(0,T.jsx)(me.A,{sx:{width:"100%",overflow:"hidden"},children:(0,T.jsx)(Se.A,{sx:{maxHeight:"calc(100vh - 200px)"},children:(0,T.jsxs)(Pe.A,{stickyHeader:!0,children:[(0,T.jsx)(_e.A,{children:(0,T.jsxs)(De.A,{children:[(0,T.jsx)(Re.A,{children:"Nom d'utilisateur"}),(0,T.jsx)(Re.A,{children:"Nom complet"}),(0,T.jsx)(Re.A,{children:"Email"}),(0,T.jsx)(Re.A,{children:"R\xf4le"}),(0,T.jsx)(Re.A,{children:"Statut"}),(0,T.jsx)(Re.A,{children:"Derni\xe8re connexion"}),(0,T.jsx)(Re.A,{align:"center",children:"Actions"})]})}),(0,T.jsx)(Ie.A,{children:i?(0,T.jsx)(De.A,{children:(0,T.jsx)(Re.A,{colSpan:7,align:"center",children:"Chargement en cours..."})}):0===r.length?(0,T.jsx)(De.A,{children:(0,T.jsx)(Re.A,{colSpan:7,align:"center",children:"Aucun administrateur trouv\xe9"})}):r.map((e=>(0,T.jsxs)(De.A,{hover:!0,children:[(0,T.jsxs)(Re.A,{children:[e.username,I(e._id)&&(0,T.jsx)(Le.A,{size:"small",label:"Vous",color:"primary",sx:{ml:1}})]}),(0,T.jsx)(Re.A,{children:`${e.firstName||""} ${e.lastName||""}`}),(0,T.jsx)(Re.A,{children:e.email||"-"}),(0,T.jsx)(Re.A,{children:(0,T.jsx)(Le.A,{label:R(e.role),color:"superAdmin"===e.role?"error":"primary",variant:"superAdmin"===e.role?"filled":"outlined"})}),(0,T.jsx)(Re.A,{children:!1!==e.active?(0,T.jsx)(Le.A,{icon:(0,T.jsx)(jt.A,{}),label:"Actif",color:"success",variant:"outlined",size:"small"}):(0,T.jsx)(Le.A,{icon:(0,T.jsx)(At.A,{}),label:"Inactif",color:"error",variant:"outlined",size:"small"})}),(0,T.jsx)(Re.A,{children:e.lastLogin?new Date(e.lastLogin).toLocaleString():"Jamais connect\xe9"}),(0,T.jsxs)(Re.A,{align:"center",children:[(0,T.jsx)(p.A,{title:"Modifier",children:(0,T.jsx)(h.A,{color:"primary",onClick:()=>w("edit",e),children:(0,T.jsx)(Me.A,{})})}),!I(e._id)&&(0,T.jsx)(p.A,{title:"Supprimer",children:(0,T.jsx)(h.A,{color:"error",onClick:()=>(e=>{b(e),y(!0)})(e),children:(0,T.jsx)(M.A,{})})})]})]},e._id)))})]})})}),(0,T.jsxs)(ke.A,{open:a,onClose:S,maxWidth:"sm",fullWidth:!0,children:[(0,T.jsx)(Ee.A,{children:"add"===d?"Ajouter un administrateur":"Modifier l'administrateur"}),(0,T.jsx)(qe.A,{children:(0,T.jsxs)(be.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"username",label:"Nom d'utilisateur",value:j.username,onChange:_,fullWidth:!0,required:!0,disabled:"edit"===d})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"password",label:"add"===d?"Mot de passe":"Nouveau mot de passe (laisser vide pour ne pas modifier)",type:"password",value:j.password,onChange:_,fullWidth:!0,required:"add"===d})}),(0,T.jsx)(be.Ay,{item:!0,xs:6,children:(0,T.jsx)(je.A,{name:"firstName",label:"Pr\xe9nom",value:j.firstName,onChange:_,fullWidth:!0})}),(0,T.jsx)(be.Ay,{item:!0,xs:6,children:(0,T.jsx)(je.A,{name:"lastName",label:"Nom",value:j.lastName,onChange:_,fullWidth:!0})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(je.A,{name:"email",label:"Email",type:"email",value:j.email,onChange:_,fullWidth:!0})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsxs)(Ve.A,{fullWidth:!0,children:[(0,T.jsx)(Ue.A,{id:"role-label",children:"R\xf4le"}),(0,T.jsx)(Oe.A,{labelId:"role-label",name:"role",value:j.role,onChange:_,label:"R\xf4le",children:gt.map((e=>(0,T.jsx)(v.A,{value:e.value,children:(0,T.jsxs)(l.A,{children:[(0,T.jsx)(m.A,{variant:"body1",children:e.label}),(0,T.jsx)(m.A,{variant:"caption",color:"textSecondary",children:e.description})]})},e.value)))})]})}),"edit"===d&&(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(mt.A,{control:(0,T.jsx)(pt.A,{checked:j.active,onChange:_,name:"active",color:"primary"}),label:"Actif"})})]})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:S,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:async()=>{try{if(!j.username)return void z.oR.error("Le nom d'utilisateur est requis");if("add"===d&&!j.password)return void z.oR.error("Le mot de passe est requis pour un nouvel administrateur");if("add"===d)await dr.A.post("/auth/admins",j),z.oR.success("Administrateur cr\xe9\xe9 avec succ\xe8s");else{const e={...j};e.password||delete e.password,await dr.A.put(`/auth/admins/${u._id}`,e),z.oR.success("Administrateur mis \xe0 jour avec succ\xe8s")}S(),C()}catch(e){console.error("Erreur lors de l'op\xe9ration:",e),e.response&&e.response.data&&e.response.data.message?z.oR.error(e.response.data.message):z.oR.error("Une erreur est survenue")}},variant:"contained",color:"primary",children:"add"===d?"Cr\xe9er":"Mettre \xe0 jour"})]})]}),(0,T.jsxs)(ke.A,{open:g,onClose:D,children:[(0,T.jsx)(Ee.A,{children:"Confirmer la suppression"}),(0,T.jsx)(qe.A,{children:(0,T.jsxs)(m.A,{children:["\xcates-vous s\xfbr de vouloir supprimer l'administrateur",(0,T.jsx)("strong",{children:null===f||void 0===f?void 0:f.username})," ? Cette action est irr\xe9versible."]})}),(0,T.jsxs)(We.A,{children:[(0,T.jsx)(P.A,{onClick:D,children:"Annuler"}),(0,T.jsx)(P.A,{onClick:async()=>{if(f)try{await dr.A.delete(`/auth/admins/${f._id}`),z.oR.success("Administrateur supprim\xe9 avec succ\xe8s"),C()}catch(e){console.error("Erreur lors de la suppression:",e),e.response&&e.response.data&&e.response.data.message?z.oR.error(e.response.data.message):z.oR.error("Une erreur est survenue lors de la suppression")}finally{D()}},color:"error",variant:"contained",children:"Supprimer"})]})]})]})},yt={getNotifications:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(await B.A.get("/notifications",{params:e})).data}catch(r){throw console.error("Erreur lors de la r\xe9cup\xe9ration des notifications:",r),r}},markAsRead:async e=>{try{return(await B.A.patch(`/notifications/${e}/read`)).data}catch(r){throw console.error("Erreur lors de la mise \xe0 jour de la notification:",r),r}},markAllAsRead:async()=>{try{return(await B.A.patch("/notifications/read-all")).data}catch(e){throw console.error("Erreur lors de la mise \xe0 jour des notifications:",e),e}},deleteNotification:async e=>{try{return(await B.A.delete(`/notifications/${e}`)).data}catch(r){throw console.error("Erreur lors de la suppression de la notification:",r),r}},getUnreadCount:async()=>{try{return(await B.A.get("/notifications",{params:{limit:1,read:!1}})).data.unreadCount}catch(e){throw console.error("Erreur lors de la r\xe9cup\xe9ration du nombre de notifications:",e),e}}};function ft(e){const{children:r,value:t,index:s,...i}=e;return(0,T.jsx)("div",{role:"tabpanel",hidden:t!==s,id:`settings-tabpanel-${s}`,"aria-labelledby":`settings-tab-${s}`,...i,children:t===s&&(0,T.jsx)(l.A,{sx:{py:3},children:r})})}const bt=function(){const[e,r]=(0,s.useState)(0),[t,i]=(0,s.useState)({notificationsEnabled:!0,emailNotifications:!1,darkMode:!1,language:"fr",securityAlerts:!0,twoFactorAuth:!1}),[n,a]=(0,s.useState)(!0),[o,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(1),[x,p]=(0,s.useState)(0),[j,A]=(0,s.useState)(!1),[v,b]=(0,s.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[C,w]=(0,s.useState)(""),[S,N]=(0,s.useState)(""),{currentUser:B,updateProfile:L}=(0,V.A)();(0,s.useEffect)((()=>{setTimeout((()=>{a(!1)}),1e3),U()}),[c]);const U=async()=>{try{A(!0);const e=10*(c-1),r=await yt.getNotifications({limit:10,skip:e});d(r.data),p(r.total)}catch(e){console.error("Erreur lors du chargement des notifications:",e),z.oR.error("Erreur lors du chargement des notifications")}finally{A(!1)}},O=e=>{const{name:r,checked:t}=e.target;i((e=>({...e,[r]:t}))),z.oR.success(`Param\xe8tre ${r} mis \xe0 jour`)},K=e=>{const{name:r,value:t}=e.target;b((e=>({...e,[r]:t})))},G=e=>{switch(e){case"info":default:return(0,T.jsx)(I.A,{color:"info"});case"warning":return(0,T.jsx)(k.A,{color:"warning"});case"error":return(0,T.jsx)(E.A,{color:"error"});case"success":return(0,T.jsx)(q.A,{color:"success"})}};return n?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,T.jsx)(_.A,{})}):(0,T.jsxs)(l.A,{children:[(0,T.jsx)(m.A,{variant:"h4",gutterBottom:!0,children:"Param\xe8tres"}),(0,T.jsxs)(me.A,{sx:{mt:3},children:[(0,T.jsxs)(br.A,{value:e,onChange:(e,t)=>{r(t)},sx:{borderBottom:1,borderColor:"divider"},centered:!0,children:[(0,T.jsx)(Cr.A,{label:"Profil"}),(0,T.jsx)(Cr.A,{label:"Notifications"}),(0,T.jsx)(Cr.A,{label:"Apparence"}),(0,T.jsx)(Cr.A,{label:"S\xe9curit\xe9"})]}),(0,T.jsx)(ft,{value:e,index:0,children:(0,T.jsx)(l.A,{sx:{p:2},children:(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Informations personnelles"}),(0,T.jsx)(g.A,{sx:{mb:3}})]}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Nom d'utilisateur",value:(null===B||void 0===B?void 0:B.username)||"",disabled:!0,variant:"outlined",margin:"normal"})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Email",value:(null===B||void 0===B?void 0:B.email)||"",variant:"outlined",margin:"normal"})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Pr\xe9nom",value:(null===B||void 0===B?void 0:B.firstName)||"",variant:"outlined",margin:"normal"})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsx)(je.A,{fullWidth:!0,label:"Nom",value:(null===B||void 0===B?void 0:B.lastName)||"",variant:"outlined",margin:"normal"})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,T.jsx)(P.A,{variant:"contained",color:"primary",children:"Enregistrer les modifications"})})})]})})}),(0,T.jsx)(ft,{value:e,index:1,children:(0,T.jsx)(l.A,{sx:{p:2},children:(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Param\xe8tres de notification"}),(0,T.jsx)(g.A,{sx:{mb:3}})]}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(Ze.A,{sx:{mb:3},children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Options de notification"}),(0,T.jsx)(mt.A,{control:(0,T.jsx)(pt.A,{checked:t.notificationsEnabled,onChange:O,name:"notificationsEnabled",color:"primary"}),label:"Activer les notifications"}),(0,T.jsx)(mt.A,{control:(0,T.jsx)(pt.A,{checked:t.emailNotifications,onChange:O,name:"emailNotifications",color:"primary",disabled:!t.notificationsEnabled}),label:"Recevoir les notifications par email"})]})})}),(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,T.jsx)(m.A,{variant:"subtitle1",children:"Historique des notifications"}),(0,T.jsx)(P.A,{startIcon:(0,T.jsx)(W.A,{}),onClick:async()=>{try{await yt.markAllAsRead(),d(o.map((e=>({...e,read:!0})))),z.oR.success("Toutes les notifications ont \xe9t\xe9 marqu\xe9es comme lues")}catch(e){console.error("Erreur lors de la mise \xe0 jour des notifications:",e),z.oR.error("Erreur lors de la mise \xe0 jour des notifications")}},disabled:o.every((e=>e.read)),children:"Tout marquer comme lu"})]}),j?(0,T.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",py:3},children:(0,T.jsx)(_.A,{size:32})}):0===o.length?(0,T.jsx)(pe.A,{severity:"info",children:"Aucune notification"}):(0,T.jsx)(D.A,{children:o.map((e=>(0,T.jsxs)(R.Ay,{sx:{backgroundColor:e.read?"transparent":"rgba(0, 0, 0, 0.04)",borderRadius:1,mb:1},secondaryAction:(0,T.jsx)(h.A,{edge:"end","aria-label":"delete",onClick:()=>(async e=>{try{await yt.deleteNotification(e),d(o.filter((r=>r._id!==e))),p((e=>e-1)),z.oR.success("Notification supprim\xe9e")}catch(r){console.error("Erreur lors de la suppression de la notification:",r),z.oR.error("Erreur lors de la suppression de la notification")}})(e._id),children:(0,T.jsx)(M.A,{})}),children:[(0,T.jsx)(y.A,{children:G(e.type)}),(0,T.jsx)(f.A,{primary:e.message,secondary:(0,T.jsxs)(T.Fragment,{children:[(0,$.A)(new Date(e.createdAt),"PPP \xe0 p",{locale:F.A}),!e.read&&(0,T.jsx)(P.A,{size:"small",sx:{ml:2},onClick:()=>(async e=>{try{await yt.markAsRead(e),d(o.map((r=>r._id===e?{...r,read:!0}:r))),z.oR.success("Notification marqu\xe9e comme lue")}catch(r){console.error("Erreur lors de la mise \xe0 jour de la notification:",r),z.oR.error("Erreur lors de la mise \xe0 jour de la notification")}})(e._id),children:"Marquer comme lu"})]}),primaryTypographyProps:{fontWeight:e.read?"normal":"bold"}})]},e._id)))}),x>10&&(0,T.jsxs)(l.A,{sx:{display:"flex",justifyContent:"center",mt:3},children:[(0,T.jsx)(P.A,{disabled:1===c,onClick:()=>u((e=>e-1)),children:"Pr\xe9c\xe9dent"}),(0,T.jsxs)(m.A,{sx:{mx:2},children:["Page ",c," sur ",Math.ceil(x/10)]}),(0,T.jsx)(P.A,{disabled:c>=Math.ceil(x/10),onClick:()=>u((e=>e+1)),children:"Suivant"})]})]})]})})}),(0,T.jsx)(ft,{value:e,index:2,children:(0,T.jsx)(l.A,{sx:{p:2},children:(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Param\xe8tres d'affichage"}),(0,T.jsx)(g.A,{sx:{mb:3}})]}),(0,T.jsx)(be.Ay,{item:!0,xs:12,children:(0,T.jsx)(Ze.A,{children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Th\xe8me"}),(0,T.jsx)(mt.A,{control:(0,T.jsx)(pt.A,{checked:t.darkMode,onChange:O,name:"darkMode",color:"primary"}),label:"Mode sombre"}),(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,sx:{mt:3},children:"Langue"}),(0,T.jsxs)(je.A,{select:!0,label:"Langue",value:t.language,onChange:e=>{i((r=>({...r,language:e.target.value}))),z.oR.success("Langue mise \xe0 jour")},SelectProps:{native:!0},fullWidth:!0,variant:"outlined",sx:{mt:1},children:[(0,T.jsx)("option",{value:"fr",children:"Fran\xe7ais"}),(0,T.jsx)("option",{value:"en",children:"English"}),(0,T.jsx)("option",{value:"es",children:"Espa\xf1ol"}),(0,T.jsx)("option",{value:"de",children:"Deutsch"}),(0,T.jsx)("option",{value:"ar",children:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629"})]})]})})})]})})}),(0,T.jsx)(ft,{value:e,index:3,children:(0,T.jsx)(l.A,{sx:{p:2},children:(0,T.jsxs)(be.Ay,{container:!0,spacing:3,children:[(0,T.jsxs)(be.Ay,{item:!0,xs:12,children:[(0,T.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Param\xe8tres de s\xe9curit\xe9"}),(0,T.jsx)(g.A,{sx:{mb:3}})]}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsx)(Ze.A,{children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"Changement de mot de passe"}),C&&(0,T.jsx)(pe.A,{severity:"error",sx:{mb:2},children:C}),S&&(0,T.jsx)(pe.A,{severity:"success",sx:{mb:2},children:S}),(0,T.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),w(""),N(""),v.newPassword===v.confirmPassword)if(v.newPassword.length<8)w("Le mot de passe doit contenir au moins 8 caract\xe8res");else try{await new Promise((e=>setTimeout(e,1e3))),N("Mot de passe mis \xe0 jour avec succ\xe8s"),b({currentPassword:"",newPassword:"",confirmPassword:""})}catch(r){console.error("Erreur lors du changement de mot de passe:",r),w("Erreur lors du changement de mot de passe")}else w("Les mots de passe ne correspondent pas")},children:[(0,T.jsx)(je.A,{fullWidth:!0,label:"Mot de passe actuel",type:"password",name:"currentPassword",value:v.currentPassword,onChange:K,variant:"outlined",margin:"normal",required:!0}),(0,T.jsx)(je.A,{fullWidth:!0,label:"Nouveau mot de passe",type:"password",name:"newPassword",value:v.newPassword,onChange:K,variant:"outlined",margin:"normal",required:!0}),(0,T.jsx)(je.A,{fullWidth:!0,label:"Confirmer le nouveau mot de passe",type:"password",name:"confirmPassword",value:v.confirmPassword,onChange:K,variant:"outlined",margin:"normal",required:!0}),(0,T.jsx)(P.A,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:"Changer le mot de passe"})]})]})})}),(0,T.jsx)(be.Ay,{item:!0,xs:12,md:6,children:(0,T.jsx)(Ze.A,{children:(0,T.jsxs)(Je.A,{children:[(0,T.jsx)(m.A,{variant:"subtitle1",gutterBottom:!0,children:"S\xe9curit\xe9 du compte"}),(0,T.jsx)(mt.A,{control:(0,T.jsx)(pt.A,{checked:t.securityAlerts,onChange:O,name:"securityAlerts",color:"primary"}),label:"Notifications de s\xe9curit\xe9"}),(0,T.jsx)(mt.A,{control:(0,T.jsx)(pt.A,{checked:t.twoFactorAuth,onChange:O,name:"twoFactorAuth",color:"primary"}),label:"Authentification \xe0 deux facteurs"}),t.twoFactorAuth&&(0,T.jsx)(pe.A,{severity:"info",sx:{mt:2},children:"L'authentification \xe0 deux facteurs est activ\xe9e. Une \xe9tape suppl\xe9mentaire de v\xe9rification sera requise lors de la connexion."})]})})})]})})})]})]})},Ct=e=>{let{children:r,requiredRole:t=null,requiredPermission:s=null,allowSuperAdmin:n=!0}=e;const{currentUser:a,hasPermission:o,isLoading:l}=(0,V.A)(),d=(0,i.zy)();if(l)return(0,T.jsx)("div",{children:"Chargement..."});if(!a)return(0,T.jsx)(i.C5,{to:"/admin/login",state:{from:d},replace:!0});if("orderManager"===t&&"productManager"===a.role)return(0,T.jsx)(i.C5,{to:"/admin/dashboard",replace:!0});if("productManager"===t&&"orderManager"===a.role)return(0,T.jsx)(i.C5,{to:"/admin/dashboard",replace:!0});if("contentEditor"===t&&("productManager"===a.role||"orderManager"===a.role))return(0,T.jsx)(i.C5,{to:"/admin/dashboard",replace:!0});if(t&&a.role!==t&&(!n||"superAdmin"!==a.role))return(0,T.jsx)(i.C5,{to:"/admin/dashboard",replace:!0});if(s){const{resource:e,action:r}=s;if(!o(e,r))return(0,T.jsx)(i.C5,{to:"/admin/dashboard",replace:!0})}return r};const wt=function(){return(0,T.jsxs)(i.BV,{children:[(0,T.jsx)(i.qh,{path:"login",element:(0,T.jsx)(fe,{})}),(0,T.jsx)(i.qh,{path:"dashboard",element:(0,T.jsx)(Ct,{children:(0,T.jsx)(xe,{children:(0,T.jsx)(we,{})})})}),(0,T.jsx)(i.qh,{path:"categories",element:(0,T.jsx)(Ct,{requiredPermission:{resource:"categories",action:"read"},children:(0,T.jsx)(xe,{children:(0,T.jsx)(ze,{})})})}),(0,T.jsx)(i.qh,{path:"subcategories",element:(0,T.jsx)(Ct,{requiredPermission:{resource:"categories",action:"read"},children:(0,T.jsx)(xe,{children:(0,T.jsx)(Te,{})})})}),(0,T.jsx)(i.qh,{path:"companies",element:(0,T.jsx)(Ct,{requiredPermission:{resource:"companies",action:"read"},children:(0,T.jsx)(xe,{children:(0,T.jsx)(Ge,{})})})}),(0,T.jsx)(i.qh,{path:"products",element:(0,T.jsx)(Ct,{requiredPermission:{resource:"products",action:"read"},children:(0,T.jsx)(xe,{children:(0,T.jsx)(ar,{})})})}),(0,T.jsx)(i.qh,{path:"products/edit/:id",element:(0,T.jsx)(Ct,{requiredPermission:{resource:"products",action:"update"},children:(0,T.jsx)(xe,{children:(0,T.jsx)(fr,{})})})}),(0,T.jsx)(i.qh,{path:"products/new",element:(0,T.jsx)(Ct,{requiredPermission:{resource:"products",action:"create"},children:(0,T.jsx)(xe,{children:(0,T.jsx)(fr,{})})})}),(0,T.jsx)(i.qh,{path:"promotions",element:(0,T.jsx)(Ct,{requiredPermission:{resource:"products",action:"update"},children:(0,T.jsx)(xe,{children:(0,T.jsx)(at,{})})})}),(0,T.jsx)(i.qh,{path:"orders",element:(0,T.jsx)(Ct,{requiredPermission:{resource:"orders",action:"read"},requiredRole:"orderManager",allowSuperAdmin:!0,children:(0,T.jsx)(xe,{children:(0,T.jsx)(st,{})})})}),(0,T.jsx)(i.qh,{path:"statistics",element:(0,T.jsx)(Ct,{children:(0,T.jsx)(xe,{children:(0,T.jsx)(ut,{})})})}),(0,T.jsx)(i.qh,{path:"profile",element:(0,T.jsx)(Ct,{children:(0,T.jsx)(xe,{children:(0,T.jsx)(ht,{})})})}),(0,T.jsx)(i.qh,{path:"settings",element:(0,T.jsx)(Ct,{children:(0,T.jsx)(xe,{children:(0,T.jsx)(bt,{})})})}),(0,T.jsx)(i.qh,{path:"admin-users",element:(0,T.jsx)(Ct,{requiredPermission:{resource:"admins",action:"read"},children:(0,T.jsx)(xe,{children:(0,T.jsx)(vt,{})})})}),(0,T.jsx)(i.qh,{path:"",element:(0,T.jsx)(i.C5,{to:"dashboard",replace:!0})}),(0,T.jsx)(i.qh,{path:"*",element:(0,T.jsx)(i.C5,{to:"dashboard",replace:!0})})]})}},63338:(e,r,t)=>{t.d(r,{A:()=>n});var s=t(29246);t(34813);const i=s.A.create({baseURL:"https://restapi-3jza.onrender.com"});i.interceptors.request.use((e=>{e.data instanceof FormData||(e.headers["Content-Type"]="application/json");const r=localStorage.getItem("token");return r&&(e.headers.Authorization=`Bearer ${r}`),e}),(e=>Promise.reject(e))),i.interceptors.response.use((e=>e),(e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),window.location.href="/admin/login"),Promise.reject(e))));new Map;const n=i}}]);